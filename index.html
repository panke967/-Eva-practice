<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>æ¬¢è¿æ¥åˆ°Evaçš„ç»ƒä¹ å°è¯¾å ‚ / Bienvenidos al mini-aula de prÃ¡ctica de Eva</title>
<!-- æ–°å¢ï¼šå¼•å…¥CSVè§£æåº“ï¼ˆPapa Parseï¼Œå‰ç«¯ç›´æ¥è¯»CSVï¼‰ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
/* åŸæœ‰æ‰€æœ‰æ ·å¼ä¸å˜ï¼Œä¿ç•™ï¼æ–°å¢å¬å†™ç›¸å…³æ ·å¼å¦‚ä¸‹ */
/* æ–°å¢ï¼šå¬å†™ç»ƒä¹ æ ·å¼ */
.dictation-container {
  margin-top: 25px;
  font-family: "Times New Roman", serif;
}
.dictation-prompt { /* å•è¯æç¤ºï¼ˆå¦‚è¯æ€§ã€ä¸­æ–‡é‡Šä¹‰ï¼‰ */
  font-size: 18px;
  line-height: 1.8;
  margin-bottom: 15px;
  color: #333;
  padding: 15px;
  background: #f9f5e8;
  border-radius: 8px;
}
.dictation-input { /* å•è¯è¾“å…¥æ¡† */
  width: 100%;
  padding: 12px 15px;
  font-size: 17px;
  border: 1px solid #ddd;
  border-radius: 8px;
  margin-bottom: 15px;
  font-family: "Times New Roman", serif;
}
.dictation-feedback { /* å¯¹é”™æç¤º */
  margin: 10px 0;
  padding: 10px 15px;
  border-radius: 8px;
  font-size: 16px;
  display: none; /* é»˜è®¤éšè— */
}
.feedback-correct { /* æ­£ç¡®æç¤º */
  background: #e6f4ea;
  color: #2e7d32;
  border: 1px solid #c8e6c9;
}
.feedback-incorrect { /* é”™è¯¯æç¤º */
  background: #fee;
  color: #c62828;
  border: 1px solid #ffcdd2;
}
.dictation-loading { /* åŠ è½½æç¤º */
  font-size: 16px;
  color: #666;
  padding: 15px;
  text-align: center;
}
/* åŸæœ‰å…¶ä»–æ ·å¼ï¼ˆå…¨å±€ã€é˜…è¯»ã€éŸ³ä¹ç­‰ï¼‰ä¸å˜ï¼Œç›´æ¥ä¿ç•™ï¼ */
/* å…¨å±€æ ·å¼ï¼šç»Ÿä¸€å­—ä½“ä¸º Times New Romanï¼Œç®€æ´å­¦ä¹ é£ */
* { margin: 0; padding: 0; box-sizing: border-box; }

body{
  background:#fff9e6;
  font-family: "Times New Roman", serif; /* å…¨å±€å­—ä½“ç»Ÿä¸€ä¸º Times New Roman */
  color:#333;
  padding:20px;
  margin:0;
}

h1,h2{text-align:center;margin:15px 0;}
h1{color:#d2691e;font-size:24px;}
h2{color:#333;font-size:20px;}

/* æ ‡é¢˜æ ·å¼ï¼šè¿˜åŸåŸå§‹æ–‡æœ¬ï¼Œå­—ä½“ä¿æŒ Times New Roman */
.page-title {
  text-align: center;
  color: #d2691e;
  font-size: 28px;
  margin-bottom: 8px;
  font-family: "Times New Roman", serif;
}
.page-subtitle {
  text-align: center;
  color: #666;
  font-size: 18px;
  margin-bottom: 30px;
  font-weight: normal;
  font-family: "Times New Roman", serif;
}

/* æ¿å—æ ·å¼ */
.section {
  max-width: 1000px;
  margin: 0 auto 30px;
  padding: 25px;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  transition: box-shadow 0.3s ease;
}
.section:hover { box-shadow: 0 4px 15px rgba(0,0,0,0.12); }
.section-title {
  color: #333;
  font-size: 20px;
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 1px solid #f0f0f0;
  font-family: "Times New Roman", serif;
}

/* æŒ‰é’®æ ·å¼ï¼šå­—ä½“ç»Ÿä¸€ä¸º Times New Roman */
.btn {
  display: inline-block;
  padding: 12px 24px;
  background: #ffd27f;
  border: none;
  border-radius: 8px;
  color: #333;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-family: "Times New Roman", serif;
  margin-right: 10px;
}
.btn:hover {
  background: #ffc04d;
  transform: translateY(-2px);
}
.btn:active { transform: translateY(0); }

/* é˜…è¯»å†…å®¹æ ·å¼ï¼šè¥¿è¯­å•è¯å­—ä½“ç¡®ä¿ä¸º Times New Roman */
.reading-container { position: relative; }
.reading-content {
  font-size: 17px;
  line-height: 2.2;
  padding-left: 20px;
  margin-top: 25px;
  font-family: "Times New Roman", serif;
}

/* éŸ³ä¹æ§åˆ¶å™¨ */
#musicBtn {
  position: fixed;
  top: 20px;
  right: 20px;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  border: none;
  background: #ffd27f;
  color: #fff;
  font-size: 22px;
  cursor: pointer;
  box-shadow: 0 3px 8px rgba(0,0,0,0.15);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 999;
  transition: all 0.3s ease;
  font-family: "Times New Roman", serif;
}
#musicBtn:hover {
  background: #ffc04d;
  transform: scale(1.05);
}
</style>
</head>
<body>
<!-- åŸæœ‰æ ‡é¢˜ã€éŸ³ä¹æ§åˆ¶å™¨ä¸å˜ -->
<h1>æ¬¢è¿æ¥åˆ°Evaçš„ç»ƒä¹ å°è¯¾å ‚</h1>
<h1>Bienvenidos al mini-aula de prÃ¡ctica de Eva</h1>

<button id="musicBtn" title="æ’­æ”¾/æš‚åœéŸ³ä¹">â–¶</button>
<audio id="bgMusic" loop>
  <source src="river_flows_in_you.mp3" type="audio/mpeg">
  æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
</audio>

<!-- é˜…è¯»ç»ƒä¹ æ¿å—ï¼ˆä¸å˜ï¼‰ -->
<div class="section">
  <h3 class="section-title">ğŸ“– é˜…è¯»-å•è¯å¼ºåŒ–å¤ä¹ </h3>
  <button id="refreshBtn" class="btn">è¿›å…¥é˜…è¯»ç»ƒä¹ </button>
  <div class="reading-container">
    <div class="reading-content" id="lectura"></div>
  </div>
</div>

<!-- å¬å†™ç»ƒä¹ æ¿å—ï¼ˆæ ¸å¿ƒä¿®æ”¹ï¼šå•è¯å¬å†™ï¼Œè¯»å–CSVï¼‰ -->
<div class="section">
  <h3 class="section-title">âœï¸ å¬å†™-å•è¯ç†Ÿæ‚‰å¤ä¹ </h3>
  <button id="startDictationBtn" class="btn">è¿›å…¥å¬å†™ç»ƒä¹ </button>
  
  <!-- å¬å†™å†…å®¹å®¹å™¨ï¼ˆé»˜è®¤éšè—ï¼‰ -->
  <div id="dictationContainer" class="dictation-container" style="display: none;">
    <!-- åŠ è½½æç¤ºï¼ˆé»˜è®¤æ˜¾ç¤ºï¼‰ -->
    <div id="dictationLoading" class="dictation-loading">
      æ­£åœ¨åŠ è½½å•è¯åº“...è¯·ç¨å€™
    </div>
    <!-- å¬å†™æ ¸å¿ƒå†…å®¹ï¼ˆåŠ è½½å®Œæˆåæ˜¾ç¤ºï¼‰ -->
    <div id="dictationCore" style="display: none;">
      <div class="dictation-prompt" id="dictationPrompt">
        è¯·æ ¹æ®æç¤ºæ‹¼å†™è¥¿è¯­å•è¯ï¼š<br>
        <strong>ä¸­æ–‡é‡Šä¹‰ï¼š</strong><span id="wordCn"></span><br>
        <strong>è¯æ€§ï¼š</strong><span id="wordPos"></span>
      </div>
      <input type="text" class="dictation-input" id="dictationAnswer" placeholder="è¯·è¾“å…¥è¥¿è¯­å•è¯...">
      <button id="submitDictationBtn" class="btn">æäº¤ç­”æ¡ˆ</button>
      <button id="refreshDictationBtn" class="btn">ä¸‹ä¸€ä¸ªå•è¯</button>
      <div class="dictation-feedback" id="dictationFeedback"></div>
    </div>
  </div>
</div>

<!-- ç¿»è¯‘ç»ƒä¹ æ¿å—ï¼ˆä¸å˜ï¼‰ -->
<div class="section">
  <h3 class="section-title">ğŸ” ç¿»è¯‘-é€ å¥é€»è¾‘ç»ƒä¹ </h3>
  <button class="btn" onclick="alert('ç¿»è¯‘åŠŸèƒ½å¼€å‘ä¸­ï¼Œå³å°†ä¸Šçº¿ï¼')">è¿›å…¥ç¿»è¯‘ç»ƒä¹ </button>
</div>

<script>
// é˜…è¯»æ¿å—åŸæœ‰ä»£ç ï¼ˆä¸å˜ï¼‰
const textosFijos = [
  // çŸ­æ–‡1-12å†…å®¹ä¸å˜...
  "Susana es de PerÃº, de Lima. Ella estÃ¡ en Madrid con su familia. Hoy ella no va al campus. Ella y su hermano mayor desayunan cafÃ© y leche. Su hermano trabaja en el banco. Ellos se levantan tarde. Por la noche, salen a conocer la ciudad.",
  "Mi amigo Juan vive en una casa grande. Ã‰l tiene dos habitaciones. Por la tarde, Juan vuelve del instituto. Primero, Ã©l se cepilla los dientes en el cuarto de baÃ±o. Luego, su abuela prepara la cena. Nosotros comemos un poco de pan y carne con alegrÃ­a.",
  "Nosotros somos de China. Vivimos en este paÃ­s. Estudiamos lengua y cultura. Vemos la vida universitaria con alegrÃ­a. Hacemos muchos trabajos de casa. Cada dÃ­a es nuevo y volvemos a empezar.",
  "VÃ­ctor y Pablo organizan su horario. Ellos estÃ¡n muy ocupados. Leen la lecciÃ³n y repasan en la biblioteca. Salen del campus a las nueve. Ellos vienen a la residencia y duermen. Los aÃ±os de doctorado son apretados.",
  "Yo desayuno con mi familia. Mi hermana se peina despuÃ©s de desayunar. Luego vamos a la escuela juntos. Yo tomo el metro y ella toma el autobÃºs. Yo vuelvo a casa por la tarde. Preparo la cena sin descansar.",
  "Ustedes tienen que presentarse ante la clase. Dicen su nombre. Luego hablan de su paÃ­s. Todos escuchan bien. DespuÃ©s, el profesor hace preguntas. Aplaudimos y decimos Â«graciasÂ» al terminar.",
  "Mi familia vive en Lima. Mi hermano mayor estudia en la universidad. Mi hermana menor va a la escuela. Mi madre es profesora de inglÃ©s. Mi padre es mÃ©dico. Yo estoy aquÃ­ en Madrid, pero voy a volver en verano.",
  "Ellos vienen al comedor al mediodÃ­a. Almuerzan juntos. Hoy hablan de su paÃ­s. Ellos son latinoamericanos: uno es cubano y el otro es peruano. Terminan de comer a la una en punto y van a la biblioteca.",
  "â€”Â¿QuÃ© haces tÃº aquÃ­ por la maÃ±ana? <br> â€”Yo preparo mi doctorado. <br>â€”Â¿Por quÃ© vienes al campus? <br>â€”Porque quiero terminar antes del verano. <br>â€”Â¿EstÃ¡s contento con el horario? <br>â€”SÃ­, estoy contento, pero es muy apretado.",
  "Nosotros estudiamos lengua en la universidad. Vivimos en la residencia cerca del campus. Por la noche repasamos la lecciÃ³n. Queremos terminar el curso con alegrÃ­a. Hablamos de la vida en EspaÃ±a sin descansar mucho.",
  "Yo me llamo Ana. Soy estudiante de espaÃ±ol. Mi amigo Paco es chileno y es estudiante tambiÃ©n. Conocemos a un profesor de China. Decimos mucho gusto al profesor. Ã‰l es de China, pero vive aquÃ­.",
  "TomÃ¡s se levanta temprano por la maÃ±ana. Ã‰l desayuna en casa con su padre. Su padre trabaja en el hospital. DespuÃ©s, TomÃ¡s toma el autobÃºs para el instituto. Por la tarde, Ã©l vuelve a casa y hace la tarea."
];

const ReadingHandler = {
  init() {
    this.bindEvents();
  },
  bindEvents() {
    document.getElementById('refreshBtn').addEventListener('click', () => this.loadRandomText());
    document.getElementById('musicBtn').addEventListener('click', this.toggleMusic);
  },
  loadRandomText() {
    const randomIdx = Math.floor(Math.random() * textosFijos.length);
    const text = textosFijos[randomIdx];
    const lecturaDiv = document.getElementById('lectura');
    lecturaDiv.innerHTML = text.replace(/â€”/g, '<span style="display: inline-block; margin: 0 5px;">â€”</span>');
  },
  toggleMusic() {
    const musicBtn = document.getElementById('musicBtn');
    const bgMusic = document.getElementById('bgMusic');
    const isPlaying = !bgMusic.paused;
    if (isPlaying) {
      bgMusic.pause();
      musicBtn.textContent = 'â–¶';
    } else {
      bgMusic.play().then(() => {
        musicBtn.textContent = 'âšâš';
      }).catch(err => {
        alert('è¯·å…è®¸æµè§ˆå™¨æ’­æ”¾éŸ³é¢‘ä»¥ä½¿ç”¨éŸ³ä¹åŠŸèƒ½');
      });
    }
  }
};

// å¬å†™æ¿å—æ ¸å¿ƒä»£ç ï¼ˆæ–°å¢+ä¿®å¤ï¼‰
const DictationHandler = {
  allWords: [],
  currentWord: null,
  // CSVè·¯å¾„å·²æŒ‰ä½ çš„æ–‡ä»¶åä¿®æ”¹ï¼Œç¡®ä¿å’Œå®é™…æ–‡ä»¶åä¸€è‡´ï¼
  csvPaths: [
    '1-U1.csv',
    '1-U2.csv',
    '1-U3.csv',
    '1-U4.csv'
  ],

  init() {
    this.bindEvents();
  },

  bindEvents() {
    document.getElementById('startDictationBtn').addEventListener('click', () => {
      document.getElementById('dictationContainer').style.display = 'block';
      this.loadAllCsv();
    });
    document.getElementById('submitDictationBtn').addEventListener('click', () => this.checkAnswer());
    document.getElementById('refreshDictationBtn').addEventListener('click', () => this.pickRandomWord());
  },

  loadAllCsv() {
    let loadedCount = 0;
    this.allWords = [];

    this.csvPaths.forEach(path => {
      Papa.parse(path, {
        download: true,
        header: true,
        complete: (result) => {
          const validWords = result.data.filter(word => word.es && word.cn);
          this.allWords = [...this.allWords, ...validWords];
          loadedCount++;

          if (loadedCount === this.csvPaths.length) {
            document.getElementById('dictationLoading').style.display = 'none';
            document.getElementById('dictationCore').style.display = 'block';
            this.pickRandomWord();
          }
        },
        error: (err) => {
          alert(`åŠ è½½CSVå¤±è´¥ï¼š${path}ï¼Œè¯·æ£€æŸ¥ï¼š1.æ–‡ä»¶åæ˜¯å¦æ­£ç¡® 2.æ˜¯å¦ç”¨Live Serveræ‰“å¼€`);
        }
      });
    });
  },

  pickRandomWord() {
    if (this.allWords.length === 0) {
      alert('æœªåŠ è½½åˆ°ä»»ä½•å•è¯ï¼Œè¯·æ£€æŸ¥CSVæ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼');
      return;
    }
    const randomIdx = Math.floor(Math.random() * this.allWords.length);
    this.currentWord = this.allWords[randomIdx];

    document.getElementById('wordCn').textContent = this.currentWord.cn;
    document.getElementById('wordPos').textContent = this.currentWord.pos || 'æœªæ ‡æ³¨';
    document.getElementById('dictationAnswer').value = '';
    document.getElementById('dictationFeedback').style.display = 'none';
  },

  checkAnswer() {
    const userInput = document.getElementById('dictationAnswer').value.trim().toLowerCase();
    const correctAnswer = this.currentWord.es.trim().toLowerCase();
    const feedbackEl = document.getElementById('dictationFeedback');

    if (!userInput) {
      feedbackEl.textContent = 'è¯·è¾“å…¥å•è¯åå†æäº¤ï¼';
      feedbackEl.className = 'dictation-feedback feedback-incorrect';
      feedbackEl.style.display = 'block';
      return;
    }

    if (userInput === correctAnswer) {
      feedbackEl.textContent = `æ­£ç¡®ï¼ğŸ‰ ç­”æ¡ˆå°±æ˜¯ï¼š${this.currentWord.es}`;
      feedbackEl.className = 'dictation-feedback feedback-correct';
    } else {
      feedbackEl.textContent = `é”™è¯¯ âŒ æ­£ç¡®ç­”æ¡ˆï¼š${this.currentWord.es}`;
      feedbackEl.className = 'dictation-feedback feedback-incorrect';
    }
    feedbackEl.style.display = 'block';
  }
}; // é—­åˆ DictationHandler å¯¹è±¡

// åˆå§‹åŒ–æ‰€æœ‰åŠŸèƒ½ï¼ˆå¿…é¡»åŒæ—¶åˆå§‹åŒ–é˜…è¯»å’Œå¬å†™ï¼ï¼‰
window.addEventListener('DOMContentLoaded', () => {
  ReadingHandler.init();
  DictationHandler.init(); // å…³é”®ï¼šä¹‹å‰æ¼äº†è¿™è¡Œï¼Œå¯¼è‡´å¬å†™åŠŸèƒ½æ²¡ç»‘å®šäº‹ä»¶
});
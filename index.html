<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>æ¬¢è¿æ¥åˆ°Evaçš„ç»ƒä¹ å°è¯¾å ‚ / Â¡Bienvenidos a la clase prÃ¡ctica de Eva!</title>
    <style>
        /* å…¨å±€æ ·å¼ä¿æŒä¸å˜ */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        /* å…¨å±€ç»Ÿä¸€ï¼šæ‰€æœ‰æ¨¡å—çš„åˆå§‹æŒ‰é’®å®¹å™¨æ ·å¼ */
        .init-container {
        text-align: center; /* å…¼å®¹åŸæœ‰å†…è”æ ·å¼çš„æ°´å¹³å±…ä¸­é€»è¾‘ */
        padding: 30px 0; /* å’Œå…¶ä»–æ¨¡å—æŒ‰é’®çš„ä¸Šä¸‹é—´è·ä¸€è‡´ */
        }
       /* ç»Ÿä¸€æ‰€æœ‰åˆå§‹æŒ‰é’®çš„å±…ä¸­è§„åˆ™ï¼ˆè¦†ç›–åŸæœ‰å†…è”æ ·å¼ï¼‰ */
       .init-container .btn {
        display: block !important;
        margin: 0 auto !important;
        }

        body{
            background:#ffd27f;
            font-family: "Times New Roman", serif;
            color:#333;
            padding:20px;
            margin:0;
        }

        h1,h2{text-align:center;margin:15px 0;}
        h1{color:#d93025;font-size:28px;}
        h2{color:#333;font-size:22px;}

        .page-title {
            text-align: center;
            color: #d93025;
            font-size: 32px;
            margin-bottom: 15px;
            font-family: "Times New Roman", serif;
            font-weight: bold;
        }
        .page-subtitle {
            text-align: center;
            color: #333;
            font-size: 20px;
            margin-bottom: 40px;
            font-weight: normal;
            font-family: "Times New Roman", serif;
        }

        .section {
            max-width: 800px;
            margin: 0 auto 40px;
            padding: 30px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: box-shadow 0.3s ease;
            min-height: 250px;
        }
        .section:hover {
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
        }
        .section-title {
            color: #d93025;
            font-size: 22px;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ffd27f;
            font-family: "Times New Roman", serif;
            text-align: center;
        }

        .btn {
            display: inline-block;
            padding: 12px 28px;
            background: #ffd27f;
            border: none;
            border-radius: 8px;
            color: #333;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: "Times New Roman", serif;
            font-weight: 500;
        }
        .btn:hover {
            background: #ffc04d;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .btn:active {
            transform: translateY(0);
            box-shadow: none;
        }

        /* å¬å†™æ¨¡å— - åŸæœ‰æ ·å¼ï¼ˆä¸ä¿®æ”¹ï¼‰ */
        .back-btn {
            background: #ffd27f;
            border: none;
            border-radius: 6px;
            color: #333;
            font-family: "Times New Roman", serif;
            font-size: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            padding: 8px 16px;
            margin-bottom: 10px;
        }
        .back-btn:hover {
            background: #ffc04d;
            transform: translateY(-2px);
        }

        .book-btn {
            padding: 12px 35px;
            background: #ffd27f;
            border: none;
            border-radius: 6px;
            color: #333;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: "Times New Roman", serif;
            margin: 0 10px 15px;
        }
        .book-btn.enabled:hover {
            background: #ffc04d;
            transform: translateY(-2px);
        }
        .book-btn.disabled {
            background: #e0e0e0;
            color: #999;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .unit-btn {
            padding: 8px 18px;
            background: #ffd27f;
            border: none;
            border-radius: 6px;
            color: #333;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: "Times New Roman", serif;
            margin: 0 8px 12px;
        }
        .unit-btn:hover {
            background: #ffc04d;
            transform: translateY(-2px);
        }

        .reading-container { position: relative; }
        .reading-content {
            font-size: 17px;
            line-height: 2.2;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
            margin-top: 25px;
            font-family: "Times New Roman", serif;
            color: #333;
            display: none;
        }

        #musicBtn {
            position: relative; /* å»æ‰åŸæ¥çš„ fixedï¼Œå› ä¸ºå¤–å±‚å®¹å™¨å·²å›ºå®šå®šä½ */
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            background: #d93025;
            color: #fff;
            font-size: 22px;
            cursor: pointer;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-family: "Times New Roman", serif;
        }
        #musicBtn:hover {
            background: #c02516;
            transform: scale(1.05);
        }

        /* æ–°å¢ï¼šä¸‹ä¸€é¦–æ–‡å­—é“¾æ¥æ ·å¼ */
        #nextSongLink {
            color: #d93025;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: "Times New Roman", serif;
            text-decoration: underline;
            margin-left: 10px;
            padding: 5px;
        }
        #nextSongLink:hover {
            color: #c02516;
            text-decoration: none;
        }

        /* å¬å†™æ¨¡å—æç¤ºæ¡†æ ·å¼ */
        .prompt-box {
            font-size: 22px;
            color: #d93025;
            margin-bottom: 10px;
            text-align: center;
            width: 100%;
            max-width: 400px;
            padding: 10px;
            box-sizing: border-box;
        }

        /* ç¿»è¯‘æ¨¡å—ä¸“å±æ ·å¼ï¼ˆç‹¬ç«‹å‘½åç©ºé—´ï¼Œä¸å½±å“å…¶ä»–æ¨¡å—ï¼‰ */
        .trans-back-btn {
            background: #ffd27f;
            border: none;
            border-radius: 6px;
            color: #333;
            font-family: "Times New Roman", serif;
            font-size: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            padding: 8px 16px;
            margin-bottom: 10px;
        }
        .trans-back-btn:hover {
            background: #ffc04d;
            transform: translateY(-2px);
        }

        .trans-book-btn {
            padding: 12px 35px;
            background: #ffd27f;
            border: none;
            border-radius: 6px;
            color: #333;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: "Times New Roman", serif;
            margin: 0 10px 15px;
        }
        .trans-book-btn.enabled:hover {
            background: #ffc04d;
            transform: translateY(-2px);
        }
        .trans-book-btn.disabled {
            background: #e0e0e0;
            color: #999;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .trans-unit-btn {
            padding: 8px 18px;
            background: #ffd27f;
            border: none;
            border-radius: 6px;
            color: #333;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: "Times New Roman", serif;
            margin: 0 8px 12px;
        }
        .trans-unit-btn:hover {
            background: #ffc04d;
            transform: translateY(-2px);
        }

        .trans-prompt-box {
            font-size: 22px;
            color: #d93025;
            text-align: center;
            width: auto; /* è‡ªé€‚åº”æ–‡æœ¬å®½åº¦ï¼Œæ›´ç´§å‡‘ */
            max-width: 400px;
            padding: 10px 20px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <h1 class="page-title">æ¬¢è¿æ¥åˆ°Evaçš„ç»ƒä¹ å°è¯¾å ‚</h1>
    <h2 class="page-subtitle">Â¡Bienvenidos a la clase prÃ¡ctica de Eva!</h2>

    <!-- æ’­æ”¾/æš‚åœæŒ‰é’® + ä¸‹ä¸€é¦–æ–‡å­—é“¾æ¥ -->
    <div style="position: fixed; top: 20px; right: 20px; display: flex; align-items: center; gap: 5px; z-index: 999;">
        <button id="musicBtn" title="æ’­æ”¾/æš‚åœ">â–¶</button>
        <span id="nextSongLink" title="ä¸‹ä¸€é¦–">ä¸‹ä¸€é¦–</span> <!-- æ–‡å­—å½¢å¼çš„ä¸‹ä¸€é¦– -->
    </div>
    <audio id="bgMusic">
        <source src="https://raw.githubusercontent.com/panke967/-Eva-practice/main/river-flows-in-you.mp3" type="audio/mpeg">
        Tu navegador no soporta el audio.
     </audio>

    <!-- é˜…è¯»-å•è¯å¼ºåŒ–å¤ä¹ ï¼ˆä¿®å¤CSVæ–‡ä»¶åŠ è½½ï¼Œä½¿ç”¨ä¸“å±lectura.csvï¼‰ -->
    <div class="section">
        <h3 class="section-title">ğŸ“– é˜…è¯»-å•è¯å¼ºåŒ–å¤ä¹ </h3>
        
        <!-- åˆå§‹çŠ¶æ€ï¼šæ˜¾ç¤ºã€Œè¿›å…¥é˜…è¯»ç»ƒä¹ ã€æŒ‰é’®ï¼ˆå’Œç¿»è¯‘/å¬åŠ›ä¸€è‡´ï¼‰ -->
        <div id="readingInit" class="init-container">
             <button id="readingStart" class="btn">è¿›å…¥é˜…è¯»ç»ƒä¹ </button>
        </div>

        <!-- ç­‰çº§é€‰æ‹©ç•Œé¢ï¼ˆé»˜è®¤éšè—ï¼Œæ¨¡ä»¿åˆ†å†Œé€‰æ‹©ï¼‰ -->
        <div id="readingLevelSelect" style="display:none; text-align:center; margin-top:15px;">
            <h4 style="margin-bottom: 20px; color: #333;">è¯·é€‰æ‹©é˜…è¯»ç­‰çº§</h4>
            <!-- è¿”å›æŒ‰é’®ï¼ˆå’Œç¿»è¯‘/å¬åŠ›çš„è¿”å›é”®æ ·å¼ä¸€è‡´ï¼‰ -->
            <button id="readingBackToInit" class="back-btn">â† è¿”å›</button>
            <!-- ç­‰çº§æŒ‰é’®ç»„ï¼ˆA1/A2/B1/B2ï¼Œä»…A1å¯ç”¨ï¼‰ -->
            <div style="display:flex; justify-content:center; flex-wrap:wrap; margin-top:10px;">
                <button class="book-btn enabled" data-level="A1">A1 ç­‰çº§</button>
                <button class="book-btn disabled" data-level="A2">A2 ç­‰çº§ï¼ˆæœªå¼€æ”¾ï¼‰</button>
                <button class="book-btn disabled" data-level="B1">B1 ç­‰çº§ï¼ˆæœªå¼€æ”¾ï¼‰</button>
                <button class="book-btn disabled" data-level="B2">B2 ç­‰çº§ï¼ˆæœªå¼€æ”¾ï¼‰</button>
            </div>
        </div>

        <!-- é˜…è¯»ç»ƒä¹ ç•Œé¢ï¼ˆé»˜è®¤éšè—ï¼ŒåŸé˜…è¯»å†…å®¹å®¹å™¨ï¼‰ -->
        <div id="readingPracticeBox" style="display: none; margin-top: 15px;">
            <div style="display: flex; gap: 10px; margin-bottom: 20px; justify-content: center;">
                <!-- åªä¿ç•™ã€Œä¸‹ä¸€ç¯‡ã€æŒ‰é’® -->
                <button id="nextTextBtn" class="btn">ä¸‹ä¸€ç¯‡</button>
                <!-- è¿”å›æŒ‰é’®ï¼ˆæ”¹ä¸ºbtnç±»ï¼Œå’Œä¸‹ä¸€ç¯‡æ ¼å¼ä¸€è‡´ï¼‰ -->
                <button id="readingBackToLevelSelect" class="btn">â† è¿”å›ç­‰çº§é€‰æ‹©</button>
            </div>
            <div class="reading-container">
                <div class="reading-content" id="lectura"></div>
            </div>
        </div>
    </div>

    <!-- ç¿»è¯‘-è¯æ±‡å¼ºåŒ–ç»ƒä¹ ï¼ˆå®Œå…¨ç‹¬ç«‹ï¼Œæ— å†²çªï¼‰ -->
    <div class="section">
        <h3 class="section-title">ğŸŒ ç¿»è¯‘-è¯æ±‡å¼ºåŒ–ç»ƒä¹ </h3>
        
        <!-- åˆå§‹çŠ¶æ€ï¼šæ˜¾ç¤ºã€Œè¿›å…¥ç¿»è¯‘ç»ƒä¹ ã€æŒ‰é’® -->
        <div id="trans-translationInit" class="init-container">
             <button id="trans-translationStart" class="btn">è¿›å…¥ç¿»è¯‘ç»ƒä¹ </button>
        </div>

        <!-- åˆ†å†Œé€‰æ‹©ç•Œé¢ï¼ˆé»˜è®¤éšè—ï¼‰ -->
        <div id="trans-translationBookSelect" style="display:none; text-align:center; margin-top:15px;">
            <h4 style="margin-bottom: 20px; color: #333;">è¯·é€‰æ‹©åˆ†å†Œ</h4>
            <!-- è¿”å›æŒ‰é’® -->
            <button id="trans-translationBackToInit" class="trans-back-btn">â† è¿”å›</button>
            <!-- åˆ†å†ŒæŒ‰é’®ç»„ï¼ˆä»…ç¬¬ä¸€å†Œå¯ç”¨ï¼‰ -->
            <div style="display:flex; justify-content:center; flex-wrap:wrap; margin-top:10px;">
                <button class="trans-book-btn enabled" data-book="1">ç¬¬ä¸€å†Œ</button>
                <button class="trans-book-btn disabled" data-book="2">ç¬¬äºŒå†Œï¼ˆæœªå¼€æ”¾ï¼‰</button>
                <button class="trans-book-btn disabled" data-book="3">ç¬¬ä¸‰å†Œï¼ˆæœªå¼€æ”¾ï¼‰</button>
            </div>
        </div>

        <!-- å•å…ƒé€‰æ‹©ç•Œé¢ï¼ˆé»˜è®¤éšè—ï¼‰ -->
        <div id="trans-translationUnitSelect" style="display:none; text-align:center; margin-top:15px;">
            <h4 style="margin-bottom: 15px; color: #333;">ç¬¬ä¸€å†Œ - è¯·é€‰æ‹©è¦ç¿»è¯‘çš„å•å…ƒ</h4>
            <!-- è¿”å›æŒ‰é’®ï¼ˆè¿”å›åˆ†å†Œé€‰æ‹©ï¼‰ -->
            <button id="trans-translationBackToBookSelect" class="trans-back-btn">â† è¿”å›åˆ†å†Œé€‰æ‹©</button>
            <!-- å•å…ƒæŒ‰é’®ç»„ï¼ˆ1-16å•å…ƒï¼‰ -->
            <div style="display:flex; justify-content:center; flex-wrap:wrap; margin-top:10px; max-width: 650px; margin-left: auto; margin-right: auto;">
                <button class="trans-unit-btn" data-unit="1">1å•å…ƒ</button>
                <button class="trans-unit-btn" data-unit="2">2å•å…ƒ</button>
                <button class="trans-unit-btn" data-unit="3">3å•å…ƒ</button>
                <button class="trans-unit-btn" data-unit="4">4å•å…ƒ</button>
                <button class="trans-unit-btn" data-unit="5">5å•å…ƒ</button>
                <button class="trans-unit-btn" data-unit="6">6å•å…ƒ</button>
                <button class="trans-unit-btn" data-unit="7">7å•å…ƒ</button>
                <button class="trans-unit-btn" data-unit="8">8å•å…ƒ</button>
                <button class="trans-unit-btn" data-unit="9">9å•å…ƒ</button>
                <button class="trans-unit-btn" data-unit="10">10å•å…ƒ</button>
                <button class="trans-unit-btn" data-unit="11">11å•å…ƒ</button>
                <button class="trans-unit-btn" data-unit="12">12å•å…ƒ</button>
                <button class="trans-unit-btn" data-unit="13">13å•å…ƒ</button>
                <button class="trans-unit-btn" data-unit="14">14å•å…ƒ</button>
                <button class="trans-unit-btn" data-unit="15">15å•å…ƒ</button>
                <button class="trans-unit-btn" data-unit="16">16å•å…ƒ</button>
            </div>
        </div>

        <!-- ç¿»è¯‘ç»ƒä¹ ç•Œé¢ï¼ˆé»˜è®¤éšè—ï¼‰ -->
        <div id="trans-translationBox" style="display: none; margin-top: 15px;">
            <div style="font-size: 14px; color: #666; margin-bottom: 15px; text-align: center;">
                å·²ç¿»è¯‘ï¼š<span id="trans-translationTotalCount">0</span> é¢˜
            </div>
            <!-- æ–°å¢å±…ä¸­å®¹å™¨ï¼šç¡®ä¿æç¤ºæ¡†æ°´å¹³å±…ä¸­ -->
            <div style="display: flex; justify-content: center; margin-bottom: 10px;">
                 <div class="trans-prompt-box" id="trans-translationPrompt"></div>
            </div>

            <!-- ç¿»è¯‘è¾“å…¥æ¡†+æ£€æŸ¥æŒ‰é’®ï¼ˆæŒ‰é’®åœ¨è¾“å…¥æ¡†å³ä¾§ï¼Œå’Œå¬å†™æ¨¡å—ä¸€è‡´ï¼‰ -->
            <div style="display: flex; align-items: flex-start; justify-content: center; gap: 10px; margin: 10px auto 20px; max-width: 550px;">
                <!-- è¾“å…¥æ¡†ï¼šå®½åº¦è‡ªé€‚åº”ï¼Œä¿ç•™åŸæœ‰é«˜åº¦ -->
                <textarea id="trans-translationInput" placeholder="è¯·è¾“å…¥è¥¿ç­ç‰™è¯­ç¿»è¯‘"
                    style="padding: 8px; flex: 1; min-width: 300px; min-height: 60px; font-family:'Times New Roman',serif; border: 1px solid #ddd; border-radius: 6px; background: #f9f9f9; outline: none; font-size: 16px; resize: vertical; white-space: pre-wrap; overflow-wrap: break-word; word-break: break-word; overflow-y: auto; margin: 0;"></textarea>
                <!-- æ£€æŸ¥æŒ‰é’®ï¼šå’Œè¾“å…¥æ¡†é¡¶éƒ¨å¯¹é½ï¼Œæ ·å¼ä¸å˜ -->
                <button id="trans-translationCheck" style="background: #ffd27f;color: #333; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 16px; font-family:'Times New Roman',serif; margin: 0;">æ£€æŸ¥æ ¸å¯¹</button>
            </div>
            <!-- æ­£ç¡®ç­”æ¡ˆæ˜¾ç¤ºåŒºåŸŸ -->
            <div id="trans-translationAnswer" style="display: none; text-align: center; margin: 15px 0; font-size: 16px; color: #009100; font-weight: bold;"></div>
            <!-- ä¸‹ä¸€å¥/ç»“æŸç»ƒä¹ æŒ‰é’® -->
            <div style="display: flex; justify-content: center; gap: 15px; margin-top: 10px;">
                <button id="trans-translationNext" style="background: #ffd27f;color: #333;border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 16px;font-family:'Times New Roman',serif;" disabled>
                    ä¸‹ä¸€å¥
                </button>
                <button id="trans-translationEnd" style="background: #ffd27f;color: #333;border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 16px;font-family:'Times New Roman',serif;">
                    ç»“æŸç»ƒä¹ 
                </button>
            </div>
        </div>
    </div>

    <!-- å¬å†™-å•è¯ç†Ÿæ‚‰å¤ä¹  -->
    <div class="section">
        <h3 class="section-title">âœï¸ å¬å†™-å•è¯ç†Ÿæ‚‰å¤ä¹ </h3>
        
        <!-- 1. åˆå§‹çŠ¶æ€ï¼šä»…æ˜¾ç¤ºã€Œè¿›å…¥å¬å†™ç»ƒä¹ ã€æŒ‰é’® -->
        <div id="dictadoInit" class="init-container">
             <button id="dictadoStart" class="btn">è¿›å…¥å¬å†™ç»ƒä¹ </button>
        </div>

        <!-- 2. åˆ†å†Œé€‰æ‹©ç•Œé¢ï¼ˆé»˜è®¤éšè—ï¼Œä»…åœ¨ç‚¹å‡»è¿›å…¥å¬å†™åæ˜¾ç¤ºï¼‰ -->
        <div id="dictadoBookSelect" style="display:none; text-align:center; margin-top:15px;">
            <h4 style="margin-bottom: 20px; color: #333;">è¯·é€‰æ‹©åˆ†å†Œ</h4>
            <!-- è¿”å›æŒ‰é’®ï¼šè¿”å›åˆå§‹çŠ¶æ€ -->
            <button id="dictadoBackToInit" class="back-btn">â† è¿”å›</button>
            <!-- åˆ†å†ŒæŒ‰é’®ç»„ï¼ˆä»…ç¬¬ä¸€å†Œå¯ç”¨ï¼‰ -->
            <div style="display:flex; justify-content:center; flex-wrap:wrap; margin-top:10px;">
                <button class="book-btn enabled" data-book="1">ç¬¬ä¸€å†Œ</button>
                <button class="book-btn disabled" data-book="2">ç¬¬äºŒå†Œï¼ˆæœªå¼€æ”¾ï¼‰</button>
                <button class="book-btn disabled" data-book="3">ç¬¬ä¸‰å†Œï¼ˆæœªå¼€æ”¾ï¼‰</button>
            </div>
        </div>

        <!-- 3. å•å…ƒé€‰æ‹©ç•Œé¢ï¼ˆé»˜è®¤éšè—ï¼Œä»…åœ¨é€‰æ‹©åˆ†å†Œåæ˜¾ç¤ºï¼‰ -->
        <div id="dictadoUnitSelect" style="display:none; text-align:center; margin-top:15px;">
            <h4 style="margin-bottom: 15px; color: #333;">ç¬¬ä¸€å†Œ - è¯·é€‰æ‹©è¦å¬å†™çš„å•å…ƒ</h4>
            <!-- è¿”å›æŒ‰é’®ï¼šè¿”å›åˆ†å†Œé€‰æ‹© -->
            <button id="dictadoBackToBookSelect" class="back-btn">â† è¿”å›åˆ†å†Œé€‰æ‹©</button>
            <!-- å•å…ƒæŒ‰é’®ç»„ï¼ˆ1-16å•å…ƒï¼‰ -->
            <div style="display:flex; justify-content:center; flex-wrap:wrap; margin-top:10px; max-width: 650px; margin-left: auto; margin-right: auto;">
                <button class="unit-btn" data-unit="1">1å•å…ƒ</button>
                <button class="unit-btn" data-unit="2">2å•å…ƒ</button>
                <button class="unit-btn" data-unit="3">3å•å…ƒ</button>
                <button class="unit-btn" data-unit="4">4å•å…ƒ</button>
                <button class="unit-btn" data-unit="5">5å•å…ƒ</button>
                <button class="unit-btn" data-unit="6">6å•å…ƒ</button>
                <button class="unit-btn" data-unit="7">7å•å…ƒ</button>
                <button class="unit-btn" data-unit="8">8å•å…ƒ</button>
                <button class="unit-btn" data-unit="9">9å•å…ƒ</button>
                <button class="unit-btn" data-unit="10">10å•å…ƒ</button>
                <button class="unit-btn" data-unit="11">11å•å…ƒ</button>
                <button class="unit-btn" data-unit="12">12å•å…ƒ</button>
                <button class="unit-btn" data-unit="13">13å•å…ƒ</button>
                <button class="unit-btn" data-unit="14">14å•å…ƒ</button>
                <button class="unit-btn" data-unit="15">15å•å…ƒ</button>
                <button class="unit-btn" data-unit="16">16å•å…ƒ</button>
            </div>
        </div>

        <!-- 4. å­¦ç”Ÿä¿¡æ¯å¼¹çª—ï¼ˆé»˜è®¤éšè—ï¼Œä»…åœ¨é€‰æ‹©å•å…ƒåæ˜¾ç¤ºï¼‰ -->
        <div id="studentInfoPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
            <div style="background: white; padding: 25px; border-radius: 10px; width: 90%; max-width: 400px; position: relative;">
                <button id="closePopupBtn" style="position: absolute; top: 10px; right: 15px; background: transparent; border: none; font-size: 22px; color: #666; cursor: pointer; padding: 5px;">Ã—</button>
                <h3 style="margin-bottom: 20px; text-align: center; font-family: 'Times New Roman', serif; color: #d93025;">è¯·è¾“å…¥ä½ çš„ä¿¡æ¯</h3>
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-family: 'Times New Roman', serif; color: #333;">å§“åï¼š</label>
                        <input type="text" id="studentName" style="width: 100%; padding: 10px; font-family: 'Times New Roman', serif; border: 1px solid #ddd; border-radius: 6px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-family: 'Times New Roman', serif; color: #333;">å­¦å·ï¼š</label>
                        <input type="text" id="studentId" style="width: 100%; padding: 10px; font-family: 'Times New Roman', serif; border: 1px solid #ddd; border-radius: 6px;">
                    </div>
                    <button id="confirmInfoBtn" class="btn" style="width: 100%;">ç¡®è®¤</button>
                </div>
            </div>
        </div>

        <!-- 5. å¬å†™è¾“å…¥æ¡†ç•Œé¢ï¼ˆé»˜è®¤éšè—ï¼Œä»…åœ¨è¾“å…¥ä¿¡æ¯åæ˜¾ç¤ºï¼Œæ— åˆ†å†Œ/å•å…ƒé€‰æ‹©é¡¹ï¼‰ -->
        <div id="dictadoBox" style="display:none; margin-top:15px; text-align: center;">
            <div style="display:flex;flex-direction:column;align-items:center;gap:15px;">
                <div style="font-size:14px;color:#666;margin-bottom:15px;text-align:center;">
                    å·²å¬å†™ï¼š<span id="dictadoTotalCount">0</span> é¢˜
                </div>
                <!-- å¬å†™æç¤ºæ¡†ï¼ˆä¸è¾“å…¥æ¡†å®½åº¦ä¸€è‡´ï¼‰ -->
                <div class="prompt-box" id="dictadoPrompt"></div>
                <div style="display:flex;align-items:center;gap:10px; width: 100%; max-width: 400px;">
                    <input id="dictadoInput" type="text" placeholder="è¯·è¾“å…¥è¥¿è¯­å•è¯" 
                        style="
                        padding: 10px;
                        width: 100%;
                        font-family:'Times New Roman',serif;
                        font-size: 16px;
                        border: 1px solid #ddd;
                        border-radius: 6px;
                        background: #f9f9f9;
                        outline: none;">
                    <button id="dictadoCheck" style="background: #ffd27f;color: #333; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 16px; font-family:'Times New Roman',serif; white-space: nowrap;">ç¡®å®š</button>
                </div>
                <div style="font-size:10px;color:#666;line-height:1.6;text-align:left;width: 100%; max-width: 400px; padding: 0 10px;">
                    1. è¯·å„ä½åŒå­¦ä½¿ç”¨è‹±è¯­/è¥¿è¯­é”®ç›˜è¾“å…¥<br>
                    2. æœ‰é˜´é˜³æ€§çš„å•è¯è¯·å†™å…¨ï¼ˆä½¿ç”¨/éš”å¼€,ä¾‹:bueno/naï¼‰<br>
                    3. é™¤ä¸“æœ‰åè¯éœ€é¦–å­—æ¯å¤§å†™ï¼Œå…¶ä½™å•è¯é»˜è®¤é¦–å­—æ¯ä¸ºå°å†™
                </div>
                <div id="dictadoResult" style="margin-top:10px;font-weight:bold;text-align:center;">
                    <span id="resultText"></span>
                    <button id="playPronunciation" class="btn" style="margin-left:10px; padding:5px 10px; font-size:14px; display:none;">ğŸ”Š å¬è¯»éŸ³</button>
                </div>
                <div style="margin-top:5px;display:flex;gap:15px;">
                    <button id="dictadoNext" class="btn" disabled>ä¸‹ä¸€ä¸ª</button>
                    <button id="dictadoEnd" class="btn">ç»“æŸå¬å†™</button>
                </div>
            </div>
        </div>
    </div>
    <!-- åŠ¨è¯å˜ä½ç»ƒä¹ æ¨¡å—ï¼ˆæ ¸å¿ƒæ¨¡å—ï¼‰ -->
    <div class="section">
        <h3 class="section-title">ğŸ¤– åŠ¨è¯-å˜ä½å·©å›ºç»ƒä¹ ï¼ˆç°åœ¨æ—¶ï¼‰</h3>
        
        <!-- 1. åˆå§‹çŠ¶æ€ï¼šæ˜¾ç¤ºã€Œè¿›å…¥ç»ƒä¹ ã€æŒ‰é’®ï¼ˆä½¿ç”¨ç»Ÿä¸€å®¹å™¨æ ·å¼ï¼‰ -->
        <div id="conjInit" class="init-container">
            <button id="conjStart" class="btn">è¿›å…¥å˜ä½ç»ƒä¹ </button>
        </div>

        <!-- 2. åˆ†å†Œé€‰æ‹©ç•Œé¢ï¼ˆä¸ç¿»è¯‘/å¬å†™æ ¼å¼ä¸€è‡´ï¼‰ -->
        <div id="conjBookSelect" style="display:none; text-align:center; margin-top:15px; width: 100%;">
            <h4 style="margin-bottom: 20px; color: #333;">è¯·é€‰æ‹©åˆ†å†Œ</h4>
            <button id="conjBackToInit" class="back-btn">â† è¿”å›</button>
            <div style="display:flex; justify-content:center; flex-wrap:wrap; margin-top:10px;">
                <button class="book-btn enabled" data-book="1">ç¬¬ä¸€å†Œ</button>
                <button class="book-btn disabled" data-book="2">ç¬¬äºŒå†Œï¼ˆæœªå¼€æ”¾ï¼‰</button>
                <button class="book-btn disabled" data-book="3">ç¬¬ä¸‰å†Œï¼ˆæœªå¼€æ”¾ï¼‰</button>
            </div>
        </div>

        <!-- 3. å•å…ƒé€‰æ‹©ç•Œé¢ï¼ˆä¸ç¿»è¯‘/å¬å†™æ ¼å¼ä¸€è‡´ï¼‰ -->
        <div id="conjUnitSelect" style="display:none; text-align:center; margin-top:15px; width: 100%;">
            <h4 style="margin-bottom: 15px; color: #333;">ç¬¬ä¸€å†Œ - è¯·é€‰æ‹©è¦ç»ƒä¹ çš„å•å…ƒ</h4>
            <button id="conjBackToBookSelect" class="back-btn">â† è¿”å›åˆ†å†Œé€‰æ‹©</button>
            <div style="display:flex; justify-content:center; flex-wrap:wrap; margin-top:10px; max-width: 650px; margin-left: auto; margin-right: auto;">
                <button class="unit-btn" data-unit="1">1å•å…ƒ</button>
                <button class="unit-btn" data-unit="2">2å•å…ƒ</button>
                <button class="unit-btn" data-unit="3">3å•å…ƒ</button>
                <button class="unit-btn" data-unit="4">4å•å…ƒ</button>
                <button class="unit-btn" data-unit="5">5å•å…ƒ</button>
                <button class="unit-btn" data-unit="6">6å•å…ƒ</button>
                <button class="unit-btn" data-unit="7">7å•å…ƒ</button>
                <button class="unit-btn" data-unit="8">8å•å…ƒ</button>
                <button class="unit-btn" data-unit="9">9å•å…ƒ</button>
                <button class="unit-btn" data-unit="10">10å•å…ƒ</button>
                <button class="unit-btn" data-unit="11">11å•å…ƒ</button>
                <button class="unit-btn" data-unit="12">12å•å…ƒ</button>
                <button class="unit-btn" data-unit="13">13å•å…ƒ</button>
                <button class="unit-btn" data-unit="14">14å•å…ƒ</button>
                <button class="unit-btn" data-unit="15">15å•å…ƒ</button>
                <button class="unit-btn" data-unit="16">16å•å…ƒ</button>
            </div>
        </div>

        <!-- 4. å­¦ç”Ÿä¿¡æ¯å¼¹çª—ï¼ˆä¸å¬å†™æ ¼å¼å®Œå…¨ä¸€è‡´ï¼‰ -->
        <div id="conjStudentInfoPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
            <div style="background: white; padding: 25px; border-radius: 10px; width: 90%; max-width: 400px; position: relative;">
                <button id="conjClosePopupBtn" style="position: absolute; top: 10px; right: 15px; background: transparent; border: none; font-size: 22px; color: #666; cursor: pointer; padding: 5px;">Ã—</button>
                <h3 style="margin-bottom: 20px; text-align: center; font-family: 'Times New Roman', serif; color: #d93025;">è¯·è¾“å…¥ä½ çš„ä¿¡æ¯</h3>
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-family: 'Times New Roman', serif; color: #333;">å§“åï¼š</label>
                        <input type="text" id="conjStudentName" style="width: 100%; padding: 10px; font-family: 'Times New Roman', serif; border: 1px solid #ddd; border-radius: 6px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-family: 'Times New Roman', serif; color: #333;">å­¦å·ï¼š</label>
                        <input type="text" id="conjStudentId" style="width: 100%; padding: 10px; font-family: 'Times New Roman', serif; border: 1px solid #ddd; border-radius: 6px;">
                    </div>
                    <button id="conjConfirmInfoBtn" class="btn" style="width: 100%;">ç¡®è®¤</button>
                </div>
            </div>
        </div>

        <!-- 5. ç»ƒä¹ ä¸»ç•Œé¢ -->
        <div id="conjPracticeBox" style="display: none; margin-top: 20px; width: 100%;">
            <!-- å·²ç»ƒä¹ ç»Ÿè®¡ï¼ˆä¸å¬å†™æ ¼å¼ä¸€è‡´ï¼‰ -->
            <div style="font-size:14px;color:#666;margin-bottom:15px;text-align:center;">
                å·²ç»ƒä¹ ï¼š<span id="conjTotalCount">0</span> ä¸ªåŠ¨è¯
            </div>

            <!-- åŠ¨è¯æç¤ºåŒº -->
            <div style="text-align: center; margin-bottom: 30px;">
                <h4 style="color: #d93025; font-size: 20px; margin-bottom: 10px;">å½“å‰ç»ƒä¹ åŠ¨è¯ï¼š<span id="conjCurrentVerb" style="font-weight: bold;"></span></h4>
                <p style="font-size: 14px; color: #666;">è¯·å®Œæˆä»¥ä¸‹6ä¸ªäººç§°çš„ç°åœ¨æ—¶å˜ä½ï¼ˆè¾“å…¥åæŒ‰å›è½¦åˆ‡æ¢ï¼‰</p>
            </div>

            <!-- 6ä¸ªäººç§°å˜ä½è¾“å…¥åŒºï¼ˆç»Ÿä¸€æ ·å¼ï¼‰ -->
            <div style="max-width: 500px; margin: 0 auto;">
                <div class="conj-item" style="display: flex; align-items: center; gap: 15px; margin-bottom: 12px;">
                    <span style="width: 80px; font-size: 16px; font-weight: 500;">æˆ‘ (yo)</span>
                    <input type="text" data-person="yo" placeholder="è¾“å…¥å˜ä½" style="flex: 1; padding: 10px; font-family: 'Times New Roman', serif; border: 1px solid #ddd; border-radius: 6px; font-size: 16px;">
                    <span class="conj-check-mark" style="width: 24px; text-align: center; font-size: 18px; display: none;">âœ…</span>
                    <span class="conj-error-mark" style="width: 24px; text-align: center; font-size: 18px; display: none;">âŒ</span>
                </div>
                <div class="conj-item" style="display: flex; align-items: center; gap: 15px; margin-bottom: 12px;">
                    <span style="width: 80px; font-size: 16px; font-weight: 500;">ä½  (tÃº)</span>
                    <input type="text" data-person="tu" placeholder="è¾“å…¥å˜ä½" style="flex: 1; padding: 10px; font-family: 'Times New Roman', serif; border: 1px solid #ddd; border-radius: 6px; font-size: 16px;">
                    <span class="conj-check-mark" style="width: 24px; text-align: center; font-size: 18px; display: none;">âœ…</span>
                    <span class="conj-error-mark" style="width: 24px; text-align: center; font-size: 18px; display: none;">âŒ</span>
                </div>
                <div class="conj-item" style="display: flex; align-items: center; gap: 15px; margin-bottom: 12px;">
                    <span style="width: 80px; font-size: 16px; font-weight: 500;">ä»–/å¥¹/æ‚¨ (Ã©l/ella/usted)</span>
                    <input type="text" data-person="el" placeholder="è¾“å…¥å˜ä½" style="flex: 1; padding: 10px; font-family: 'Times New Roman', serif; border: 1px solid #ddd; border-radius: 6px; font-size: 16px;">
                    <span class="conj-check-mark" style="width: 24px; text-align: center; font-size: 18px; display: none;">âœ…</span>
                    <span class="conj-error-mark" style="width: 24px; text-align: center; font-size: 18px; display: none;">âŒ</span>
                </div>
                <div class="conj-item" style="display: flex; align-items: center; gap: 15px; margin-bottom: 12px;">
                    <span style="width: 80px; font-size: 16px; font-weight: 500;">æˆ‘ä»¬ (nosotros)</span>
                    <input type="text" data-person="nosotros" placeholder="è¾“å…¥å˜ä½" style="flex: 1; padding: 10px; font-family: 'Times New Roman', serif; border: 1px solid #ddd; border-radius: 6px; font-size: 16px;">
                    <span class="conj-check-mark" style="width: 24px; text-align: center; font-size: 18px; display: none;">âœ…</span>
                    <span class="conj-error-mark" style="width: 24px; text-align: center; font-size: 18px; display: none;">âŒ</span>
                </div>
                <div class="conj-item" style="display: flex; align-items: center; gap: 15px; margin-bottom: 12px;">
                    <span style="width: 80px; font-size: 16px; font-weight: 500;">ä½ ä»¬ (vosotros)</span>
                    <input type="text" data-person="vosotros" placeholder="è¾“å…¥å˜ä½" style="flex: 1; padding: 10px; font-family: 'Times New Roman', serif; border: 1px solid #ddd; border-radius: 6px; font-size: 16px;">
                    <span class="conj-check-mark" style="width: 24px; text-align: center; font-size: 18px; display: none;">âœ…</span>
                    <span class="conj-error-mark" style="width: 24px; text-align: center; font-size: 18px; display: none;">âŒ</span>
                </div>
                <div class="conj-item" style="display: flex; align-items: center; gap: 15px; margin-bottom: 12px;">
                    <span style="width: 80px; font-size: 16px; font-weight: 500;">ä»–ä»¬/å¥¹ä»¬/è¯¸ä½ (ellos/ellas/ustedes)</span>
                    <input type="text" data-person="ellos" placeholder="è¾“å…¥å˜ä½" style="flex: 1; padding: 10px; font-family: 'Times New Roman', serif; border: 1px solid #ddd; border-radius: 6px; font-size: 16px;">
                    <span class="conj-check-mark" style="width: 24px; text-align: center; font-size: 18px; display: none;">âœ…</span>
                    <span class="conj-error-mark" style="width: 24px; text-align: center; font-size: 18px; display: none;">âŒ</span>
                </div>
            </div>

            <!-- æ­£ç¡®ç­”æ¡ˆæ˜¾ç¤ºåŒº -->
            <div id="conjCorrectAnswers" style="max-width: 500px; margin: 20px auto 0; padding: 15px; background: #f9f9f9; border-radius: 8px; display: none;">
                <h5 style="color: #d93025; margin-bottom: 10px; font-size: 16px;">æ­£ç¡®ç­”æ¡ˆï¼š</h5>
                <div id="conjAnswersList" style="font-size: 15px; line-height: 1.8;"></div>
            </div>

            <!-- æŒ‰é’®åŒºï¼ˆä¸å¬å†™æ ¼å¼ä¸€è‡´ï¼‰ -->
            <div style="display: flex; justify-content: center; gap: 15px; margin-top: 30px;">
                <button id="conjCheck" class="btn">æ ¸å¯¹ç­”æ¡ˆ</button>
                <button id="conjNext" class="btn" disabled>ä¸‹ä¸€ä¸ªåŠ¨è¯</button>
                <button id="conjEnd" class="btn">ç»“æŸç»ƒä¹ </button>
            </div>
        </div>
    </div>

    <script>
        // æ­Œæ›²åˆ—è¡¨ï¼šæ–°å¢çš„æ­Œæ›²ç›´æ¥æ·»åŠ åˆ°æ•°ç»„æœ«å°¾å³å¯
        const musicList = [
            "https://raw.githubusercontent.com/panke967/-Eva-practice/main/river-flows-in-you.mp3", // åŸæœ‰æ­Œæ›²
            "https://raw.githubusercontent.com/panke967/-Eva-practice/main/querido-tommy.mp3",
            "https://raw.githubusercontent.com/panke967/-Eva-practice/main/if-you.mp3"// æ–°å¢æ­Œæ›²
        ];
        let currentMusicIndex = 0; // å½“å‰æ’­æ”¾çš„æ­Œæ›²ç´¢å¼•ï¼ˆé»˜è®¤ä»ç¬¬ä¸€é¦–å¼€å§‹ï¼‰

        // é˜…è¯»æ¨¡å—ï¼šä¿®å¤CSVæ–‡ä»¶åŠ è½½ï¼Œä½¿ç”¨ä¸“å±çš„lectura.csvï¼ˆè€Œéç¿»è¯‘çš„f1u1.csvï¼‰
        const ReadingHandler = {
            texts: [],
            selectedLevel: '', // é€‰ä¸­çš„é˜…è¯»ç­‰çº§ï¼ˆA1/A2/B1/B2ï¼‰
            init() {
                this.bindEvents();
            },

            // ä¿®å¤ï¼šåŠ è½½é˜…è¯»ä¸“å±çš„CSVæ–‡ä»¶ï¼ˆlectura.csvï¼‰ï¼Œä¸åŒç­‰çº§å¯æ‰©å±•ä¸ºlectura-A1.csvç­‰
            async loadCSV(level) {
                this.texts = []; // åˆ‡æ¢ç­‰çº§æ—¶æ¸…ç©ºæ—§æ•°æ®
                let fileName = '';
                
                // ç­‰çº§å¯¹åº”æ–‡ä»¶é…ç½®ï¼ˆé˜…è¯»ä¸“å±æ–‡ä»¶ï¼Œé¿å…å’Œç¿»è¯‘å†²çªï¼‰
                switch(level) {
                    case 'A1':
                        fileName = 'lecturaA1.csv'; // é˜…è¯»A1ç­‰çº§åŠ è½½ä¸“å±çš„lectura.csv
                        break;
                    case 'A2':
                        fileName = 'lecturaA2.csv'; // åç»­æ‰©å±•A2ç­‰çº§æ—¶ä½¿ç”¨
                        break;
                    case 'B1':
                        fileName = 'lecturaB1.csv'; // åç»­æ‰©å±•B1ç­‰çº§æ—¶ä½¿ç”¨
                        break;
                    case 'B2':
                        fileName = 'lecturaB2.csv'; // åç»­æ‰©å±•B2ç­‰çº§æ—¶ä½¿ç”¨
                        break;
                    default:
                        alert('æ— æ•ˆçš„é˜…è¯»ç­‰çº§');
                        return false;
                }

                try {
                    // GitHub ä»“åº“ä¿¡æ¯ï¼ˆä¿æŒå’Œå…¶ä»–æ¨¡å—ä¸€è‡´ï¼‰
                    const githubUsername = "panke967";
                    const githubRepo = "-Eva-practice";
                    const githubBranch = "main";
                    const rawUrl = `https://raw.githubusercontent.com/${githubUsername}/${githubRepo}/${githubBranch}/${fileName}`;
                    
                    const response = await fetch(rawUrl);
                    if (!response.ok) throw new Error(`ç­‰çº§ ${level} çš„é˜…è¯»æ–‡ä»¶ ${fileName} åŠ è½½å¤±è´¥ï¼ˆé“¾æ¥ï¼š${rawUrl}ï¼‰`);
                    
                    const text = await response.text();
                    this.parseCSV(text); // è§£æCSVå†…å®¹
                    return true;
                } catch (err) {
                    alert('é˜…è¯»çŸ­æ–‡åŠ è½½å¤±è´¥ï¼š' + err.message);
                    console.error(err);
                    return false;
                }
            },

            parseCSV(csvText) {
    const lines = csvText.trim().split('\n');
    this.texts = [];
    let currentText = '';
    let inArticle = false; // æ ‡è®°æ˜¯å¦æ­£åœ¨è§£æä¸€ç¯‡æ–‡ç« 

    for (const line of lines) {
        const trimmedLine = line.trim();
        if (trimmedLine === '') continue;

        // 1. è¯†åˆ«æ–‡ç« å¼€å§‹ï¼šExcelç”Ÿæˆçš„CSVï¼Œæ–‡ç« å¼€å¤´æ˜¯ "ï¼ˆå¯èƒ½å¤šä¸ªï¼Œæ¯”å¦‚ """"ï¼‰
        if (!inArticle && trimmedLine.startsWith('"')) {
            inArticle = true;
            // å»æ‰å¼€å¤´æ‰€æœ‰å¤šä½™çš„ "ï¼ˆä¸ç®¡ExcelåŠ äº†å‡ å±‚ï¼‰
            currentText = trimmedLine.replace(/^"+/, '');
        }
        // 2. è¯†åˆ«æ–‡ç« ç»“æŸï¼šExcelç”Ÿæˆçš„CSVï¼Œæ–‡ç« ç»“å°¾æ˜¯ "ï¼ˆå¯èƒ½å¤šä¸ªï¼‰
        else if (inArticle && trimmedLine.endsWith('"')) {
            inArticle = false;
            // å»æ‰ç»“å°¾æ‰€æœ‰å¤šä½™çš„ "ï¼Œå¹¶æŠŠExcelé‡Œçš„æ¢è¡Œï¼ˆ\nï¼‰è½¬æˆå®é™…æ¢è¡Œ
            currentText += '\n' + trimmedLine.replace(/"+$/, '');
            // æ¸…ç†æœ«å°¾å¤šä½™ç©ºæ ¼ï¼ŒåŠ å…¥æ–‡ç« åˆ—è¡¨
            const cleanText = currentText.trimEnd();
            this.texts.push(cleanText);
            currentText = '';
        }
        // 3. è§£ææ–‡ç« ä¸­é—´æ®µè½ï¼ˆExcelé‡Œå•å…ƒæ ¼å†…çš„æ¢è¡Œï¼‰
        else if (inArticle) {
            currentText += '\n' + trimmedLine;
        }
    }

    // å¤„ç†æœ€åä¸€ç¯‡æ²¡æ­£å¸¸ç»“æŸçš„æ–‡ç« ï¼ˆé˜²æ­¢é—æ¼ï¼‰
    if (currentText.trim() !== '' && !inArticle) {
        this.texts.push(currentText.trimEnd());
    }

    console.log(`é˜…è¯»æ¨¡å—åŠ è½½å®Œæˆ ${this.texts.length} ç¯‡çŸ­æ–‡`);
    if (this.texts.length === 0) alert(`âš ï¸ æœªä»CSVä¸­è¯»å–åˆ°ä»»ä½•çŸ­æ–‡ï¼Œè¯·æ£€æŸ¥Excelå•å…ƒæ ¼æ ¼å¼`);
},

            // ç»‘å®šæ‰€æœ‰äº‹ä»¶
            bindEvents() {
                // 1. ç‚¹å‡»ã€Œè¿›å…¥é˜…è¯»ç»ƒä¹ ã€â†’ æ˜¾ç¤ºç­‰çº§é€‰æ‹©ç•Œé¢
                document.getElementById('readingStart').addEventListener('click', () => {
                    document.getElementById('readingInit').style.display = 'none';
                    document.getElementById('readingLevelSelect').style.display = 'block';
                });

                // 2. ç­‰çº§é€‰æ‹©é¡µè¿”å› â†’ éšè—ç­‰çº§é€‰æ‹©ï¼Œæ˜¾ç¤ºåˆå§‹æŒ‰é’®
                document.getElementById('readingBackToInit').addEventListener('click', () => {
                    document.getElementById('readingLevelSelect').style.display = 'none';
                    document.getElementById('readingInit').style.display = 'block';
                    this.reset(); // é‡ç½®é˜…è¯»çŠ¶æ€
                });

                // 3. é€‰æ‹©é˜…è¯»ç­‰çº§ï¼ˆä»…A1å¯ç”¨ï¼Œå…¶ä½™æç¤ºæœªå¼€æ”¾ï¼‰
                document.querySelectorAll('#readingLevelSelect .book-btn').forEach(btn => {
                    btn.addEventListener('click', async (e) => {
                        const level = e.currentTarget.dataset.level;
                        if (e.currentTarget.classList.contains('disabled')) {
                            alert(`ã€Œ${level} ç­‰çº§ã€æš‚æœªå¼€æ”¾ï¼Œæ•¬è¯·æœŸå¾…ï¼`);
                            return;
                        }
                        this.selectedLevel = level;
                        
                        // åŠ è½½å¯¹åº”ç­‰çº§çš„é˜…è¯»ä¸“å±CSVæ–‡ä»¶
                        const loadSuccess = await this.loadCSV(level);
                        if (loadSuccess) {
                            document.getElementById('readingLevelSelect').style.display = 'none';
                            document.getElementById('readingPracticeBox').style.display = 'block';
                            this.loadRandomText(); // åŠ è½½ç¬¬ä¸€ç¯‡çŸ­æ–‡
                        }
                    });
                });

                // 4. ç»ƒä¹ ç•Œé¢è¿”å› â†’ éšè—ç»ƒä¹ ç•Œé¢ï¼Œæ˜¾ç¤ºç­‰çº§é€‰æ‹©
                document.getElementById('readingBackToLevelSelect').addEventListener('click', () => {
                    document.getElementById('readingPracticeBox').style.display = 'none';
                    document.getElementById('readingLevelSelect').style.display = 'block';
                    this.reset(); // é‡ç½®é˜…è¯»çŠ¶æ€
                });

                // 5. ä¸‹ä¸€ç¯‡çŸ­æ–‡äº‹ä»¶
                document.getElementById('nextTextBtn').addEventListener('click', () => this.loadRandomText());
                
                // 6. éŸ³ä¹æ’­æ”¾/æš‚åœï¼ˆä¿æŒåŸæœ‰é€»è¾‘ï¼‰
                document.getElementById('musicBtn').addEventListener('click', this.toggleMusic.bind(this)); // ç»‘å®šthisæŒ‡å‘
                // 7. ä¸‹ä¸€é¦–æ–‡å­—é“¾æ¥äº‹ä»¶
                document.getElementById('nextSongLink').addEventListener('click', () => {
                    const bgMusic = document.getElementById('bgMusic');
                    const musicBtn = document.getElementById('musicBtn');
                    
                    // 1. ç´¢å¼•+1ï¼Œå¾ªç¯åˆ°åˆ—è¡¨å¼€å¤´ï¼ˆæœ€åä¸€é¦–â†’ç¬¬ä¸€é¦–ï¼‰
                    currentMusicIndex = (currentMusicIndex + 1) % musicList.length;
                    
                    // 2. åˆ‡æ¢åˆ°ä¸‹ä¸€é¦–æ­Œæ›²å¹¶æ’­æ”¾
                    bgMusic.src = musicList[currentMusicIndex];
                    bgMusic.play().then(() => {
                        // 3. åŒæ­¥æ›´æ–°æ’­æ”¾æŒ‰é’®çŠ¶æ€ï¼ˆæ˜¾ç¤ºæš‚åœå›¾æ ‡ï¼‰
                        musicBtn.textContent = 'âšâš';
                    }).catch(err => {
                        console.log('ä¸‹ä¸€é¦–æ’­æ”¾å¤±è´¥ï¼š', err);
                        alert('è¯·æ‰‹åŠ¨å…è®¸æµè§ˆå™¨æ’­æ”¾éŸ³é¢‘');
                    });
                });
            },

            loadRandomText() {
    if (this.texts.length === 0) {
        alert('æš‚æ— å¯ç”¨é˜…è¯»çŸ­æ–‡ï¼Œè¯·ç¨åé‡è¯•');
        return;
    }
    const randomIdx = Math.floor(Math.random() * this.texts.length);
    let text = this.texts[randomIdx]; // æ‹¿åˆ°è§£æåçš„æ–‡ç« å†…å®¹
    
    // å…³é”®æ“ä½œï¼š1. æŒ‰æ¢è¡Œåˆ†å‰²æˆæ®µè½ 2. ç»™æ¯ä¸ªæ®µè½å¼€å¤´åŠ  4 ä¸ªç©ºæ ¼ 3. é‡æ–°åˆå¹¶
    const paragraphs = text.split('\n'); // æŠŠæ–‡ç« æŒ‰æ¢è¡Œæ‹†æˆæ®µè½æ•°ç»„
    const textWithIndent = paragraphs.map(para => {
        // ç»™æ¯ä¸ªæ®µè½å¼€å¤´åŠ  4 ä¸ªç©ºæ ¼ï¼ˆæƒ³åŠ æ›´å¤šå°±å¤šå†™å‡ ä¸ªç©ºæ ¼ï¼Œæ¯”å¦‚ "     " æ˜¯ 5 ä¸ªï¼‰
        return '    ' + para.trimStart(); // trimStart() ç¡®ä¿åªä¿ç•™æˆ‘ä»¬åŠ çš„ç©ºæ ¼ï¼Œé¿å…é‡å¤
    }).join('\n'); // é‡æ–°åˆå¹¶æˆå®Œæ•´æ–‡ç« 
    
    const lecturaDiv = document.getElementById('lectura');
    // ä¿ç•™ white-space: pre-wrapï¼Œç¡®ä¿ç©ºæ ¼æ˜¾ç¤º
    lecturaDiv.innerHTML = `<div style="white-space: pre-wrap;">${textWithIndent.replace(/\n/g, '<br>')}</div>`;
    lecturaDiv.style.display = 'block';
},

            // é‡ç½®é˜…è¯»çŠ¶æ€ï¼ˆåˆ‡æ¢ç­‰çº§/è¿”å›æ—¶è°ƒç”¨ï¼‰
            reset() {
                this.texts = [];
                this.selectedLevel = '';
                document.getElementById('lectura').style.display = 'none';
            },

            // éŸ³ä¹æ’­æ”¾/æš‚åœï¼ˆä¿®å¤thisæŒ‡å‘é—®é¢˜ï¼‰
            toggleMusic() {
                const musicBtn = document.getElementById('musicBtn');
                const bgMusic = document.getElementById('bgMusic');
                const isPlaying = !bgMusic.paused;

                if (isPlaying) {
                    bgMusic.pause();
                    musicBtn.textContent = 'â–¶';
                } else {
                    bgMusic.src = musicList[currentMusicIndex]; // ä½¿ç”¨æ­Œæ›²åˆ—è¡¨
                    bgMusic.play().then(() => {
                        musicBtn.textContent = 'âšâš';
                    }).catch(err => {
                        console.log('éŸ³ä¹æ’­æ”¾è¢«æ‹¦æˆªï¼š', err);
                        alert('è¯·æ‰‹åŠ¨å…è®¸æµè§ˆå™¨æ’­æ”¾éŸ³é¢‘');
                    });
                }

                // ç›‘å¬æ­Œæ›²ç»“æŸï¼Œè‡ªåŠ¨ä¸‹ä¸€é¦–
                bgMusic.onended = function() {
                    currentMusicIndex = (currentMusicIndex + 1) % musicList.length;
                    bgMusic.src = musicList[currentMusicIndex];
                    bgMusic.play();
                };
            }
        };

        // å¬å†™æ¨¡å—ï¼ˆå±‚çº§æµç¨‹ï¼šè¿›å…¥å¬å†™â†’é€‰åˆ†å†Œâ†’é€‰å•å…ƒâ†’è¾“ä¿¡æ¯â†’æ˜¾ç¤ºè¾“å…¥æ¡†ï¼‰
        const DictadoHandler = {
            palabras: [],
            usedIndexes: [],
            idx: 0,
            correct: 0,
            total: 0,
            isChecked: false,
            currentWord: null,
            wrongWords: [],
            studentName: '',
            studentId: '',
            startTime: null,
            isDictadoStarted: false,
            selectedBook: null, // é€‰ä¸­çš„åˆ†å†Œï¼ˆå¦‚ 1ï¼‰
            selectedUnit: null, // é€‰ä¸­çš„å•å…ƒï¼ˆå¦‚ 1-16ï¼‰

            init() {
                this.bindEvents();
            },

            // ç»“æŸå¬å†™ï¼Œæ˜¾ç¤ºç»“æœ
            endDictado() {
                document.getElementById('dictadoBox').style.display = 'none';
                const accuracy = this.total > 0 ? (this.correct / this.total * 100).toFixed(2) : 0;
                let wrongListHtml = '';
                if (this.wrongWords.length > 0) {
                    wrongListHtml = this.wrongWords.map((item, index) => `
                        <li style="margin: 8px 0; line-height: 1.5;">
                            ${index + 1}. ä½ çš„è¾“å…¥ï¼š<span style="color:red;">${item.input}</span> â†’ 
                            æ­£ç¡®ç­”æ¡ˆï¼š<span style="color:green;">${item.correctEs}</span>ï¼ˆ${item.cn}ï¼‰
                        </li>
                    `).join('');
                } else {
                    wrongListHtml = '<li style="color:#666;">ğŸ‰ æ²¡æœ‰é”™è¯ï¼Œå¤ªæ£’äº†ï¼</li>';
                }

                const endTime = Date.now();
                const totalMs = endTime - this.startTime;
                const minutes = Math.floor(totalMs / 60000);
                const seconds = Math.floor((totalMs % 60000) / 1000);
                const formattedTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                const finishTime = new Date(endTime).toLocaleString('zh-CN');

                const resultHtml = `
                <div style="font-size: 16px; line-height: 2; padding: 10px;">
                    <p>ğŸ“ å­¦ç”Ÿä¿¡æ¯ï¼š</p>
                    <p>å§“åï¼š${this.studentName}</p>
                    <p>å­¦å·ï¼š${this.studentId}</p>
                    <p>ç»ƒä¹ åˆ†å†Œï¼šç¬¬ ${this.selectedBook} å†Œ</p>
                    <p>ç»ƒä¹ å•å…ƒï¼šç¬¬ ${this.selectedUnit} å•å…ƒ</p>
                    <p style="margin-top: 15px;">ğŸ“Š å¬å†™ç»“æœï¼š</p>
                    <p>æ€»é¢˜æ•°ï¼š${this.total} é“</p>
                    <p>æ­£ç¡®æ•°ï¼š${this.correct} é“</p>
                    <p>æ­£ç¡®ç‡ï¼š${accuracy}%</p>
                    <p>å®Œæˆæ—¶é—´ï¼š${finishTime}</p>
                    <p>æ€»è€—æ—¶ï¼š${formattedTime}</p>
                    <p style="margin-top: 15px; font-weight: bold;">é”™è¯å¤ä¹ ï¼š</p>
                    <ul style="margin: 5px 0; padding-left: 20px;">${wrongListHtml}</ul>
                </div>
                `;

                const popup = document.createElement('div');
                popup.style.cssText = `
                    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                    background: white; padding: 20px; border: 2px solid #d93025; border-radius: 8px;
                    max-width: 400px; width: 85%; max-height: 70vh; overflow-y: auto; z-index: 9999; padding-top: 40px;
                `;
                popup.innerHTML = `
                    ${resultHtml}
                    <button id="popupCloseBottom" style="
                        margin-top: 15px; padding: 8px 20px; 
                        background: #d93025; color: white; 
                        border: none; border-radius: 4px; cursor: pointer;
                        display: block; margin-left: auto; margin-right: auto;">
                        å…³é—­
                    </button>
                `;

                const mask = document.createElement('div');
                mask.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9998;';
                document.body.appendChild(mask);
                document.body.appendChild(popup);

                document.getElementById('popupCloseBottom').addEventListener('click', () => {
                    document.body.removeChild(popup);
                    document.body.removeChild(mask);
                    // å…³é—­ç»“æœåè¿”å›åˆå§‹çŠ¶æ€
                    this.resetDictado();
                    document.getElementById('dictadoInit').style.display = 'block';
                });

                this.resetDictado();
            },

            // é‡ç½®å¬å†™çŠ¶æ€
            resetDictado() {
                this.correct = 0;
                this.total = 0;
                this.wrongWords = [];
                this.isChecked = false;
                this.currentWord = null;
                this.usedIndexes = [];
                this.studentName = '';
                this.studentId = '';
                this.selectedBook = null;
                this.selectedUnit = null;
                document.getElementById('dictadoInput').value = '';
                document.getElementById('dictadoResult').textContent = '';
                document.getElementById('dictadoCheck').disabled = false;
                document.getElementById('dictadoNext').disabled = true;
                document.getElementById('dictadoTotalCount').textContent = '0';
                this.startTime = null;
                this.isDictadoStarted = false;
            },

            // åŠ è½½æŒ‡å®šå•å…ƒçš„å•è¯
            async cargarCSV(book, unit) {
                try {
                    // GitHub ä»“åº“ä¿¡æ¯
                    const githubUsername = "panke967";
                    const githubRepo = "-Eva-practice";
                    const githubBranch = "main";
                    
                    // ç¬¬ä¸€å†Œå•å…ƒæ–‡ä»¶å‘½åï¼š1u1.csv ~ 1u16.csv
                    const file = `${book}u${unit}.csv`;
                    const rawUrl = `https://raw.githubusercontent.com/${githubUsername}/${githubRepo}/${githubBranch}/${file}`;
                    
                    const res = await fetch(rawUrl);
                    if (!res.ok) throw new Error(`ç¬¬ ${book} å†Œ ç¬¬ ${unit} å•å…ƒçš„æ–‡ä»¶ã€Œ${file}ã€åŠ è½½å¤±è´¥ï¼ˆé“¾æ¥ï¼š${rawUrl}ï¼‰`);
                    
                    const text = await res.text();
                    this.palabras = [];

                    const lines = text.trim().split('\n');
                    const dataLines = lines.slice(1);

                    dataLines.forEach((line, lineIdx) => {
                        const cleanLine = line.trim()
                            .replace(/^"|"$/g, '')
                            .replace(/,,+/g, ',')
                            .replace(/^,|,$/g, '');

                        if (!cleanLine) return;

                        const parts = cleanLine.split(',').map(s => {
                            return s.trim().replace(/^"|"$/g, '')
                                .replace(/ï¼Œ/g, '')
                                .replace(/\s+/g, ' ');
                        }).filter(Boolean);

                        let es, cn, pos;
                        if (parts.length === 3) {
                            [es, cn, pos] = parts;
                        } else if (parts.length === 2) {
                            [es, cn] = parts;
                            pos = 'æœªåˆ†ç±»';
                        } else {
                            console.warn(`CSV ç¬¬ ${lineIdx+2} è¡Œæ ¼å¼é”™è¯¯ï¼š${line}ï¼ˆå·²è·³è¿‡ï¼‰`);
                            return;
                        }

                        const finalEs = es.trim().replace(/[\u2000-\u206F\uFEFF\u00A0]/g, '');
                        this.palabras.push({ es: finalEs, cn: cn.trim(), pos: pos.trim() });
                    });

                    console.log(`ç¬¬ ${book} å†Œ ç¬¬ ${unit} å•å…ƒ åŠ è½½å®Œæˆ ${this.palabras.length} ä¸ªå•è¯`);
                    if (this.palabras.length === 0) alert(`âš ï¸ ç¬¬ ${book} å†Œ ç¬¬ ${unit} å•å…ƒ æœªåŠ è½½åˆ°ä»»ä½•å•è¯ï¼Œè¯·æ£€æŸ¥CSVæ ¼å¼`);
                    return true;
                } catch (err) {
                    alert('âŒ å•è¯åŠ è½½å¤±è´¥ï¼š' + err.message);
                    console.error(err);
                    return false;
                }
            },

            // ç»‘å®šæ‰€æœ‰äº‹ä»¶ï¼ˆå±‚çº§æµç¨‹æ§åˆ¶ï¼‰
            bindEvents() {
                // 1. åˆå§‹çŠ¶æ€ï¼šç‚¹å‡»ã€Œè¿›å…¥å¬å†™ç»ƒä¹ ã€â†’ æ˜¾ç¤ºåˆ†å†Œé€‰æ‹©
                document.getElementById('dictadoStart').addEventListener('click', () => {
                    document.getElementById('dictadoInit').style.display = 'none';
                    document.getElementById('dictadoBookSelect').style.display = 'block';
                });

                // 2. åˆ†å†Œé€‰æ‹©é¡µï¼šç‚¹å‡»ã€Œè¿”å›ã€â†’ å›åˆ°åˆå§‹çŠ¶æ€
                document.getElementById('dictadoBackToInit').addEventListener('click', () => {
                    document.getElementById('dictadoBookSelect').style.display = 'none';
                    document.getElementById('dictadoInit').style.display = 'block';
                });

                // 3. åˆ†å†Œé€‰æ‹©é¡µï¼šç‚¹å‡»åˆ†å†Œ â†’ æ˜¾ç¤ºå•å…ƒé€‰æ‹©
                document.querySelectorAll('#dictadoBookSelect .book-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const book = e.currentTarget.dataset.book;
                        if (e.currentTarget.classList.contains('disabled')) {
                            alert(`ç¬¬ ${book} å†Œæš‚æœªå¼€æ”¾ï¼Œæ•¬è¯·æœŸå¾…ï¼`);
                            return;
                        }
                        this.selectedBook = book;
                        document.getElementById('dictadoBookSelect').style.display = 'none';
                        document.getElementById('dictadoUnitSelect').style.display = 'block';
                    });
                });

                // 4. å•å…ƒé€‰æ‹©é¡µï¼šç‚¹å‡»ã€Œè¿”å›ã€â†’ å›åˆ°åˆ†å†Œé€‰æ‹©
                document.getElementById('dictadoBackToBookSelect').addEventListener('click', () => {
                    document.getElementById('dictadoUnitSelect').style.display = 'none';
                    document.getElementById('dictadoBookSelect').style.display = 'block';
                });

                // 5. å•å…ƒé€‰æ‹©é¡µï¼šç‚¹å‡»å•å…ƒ â†’ æ˜¾ç¤ºå­¦ç”Ÿä¿¡æ¯å¼¹çª—
                document.querySelectorAll('#dictadoUnitSelect .unit-btn').forEach(btn => {
                    btn.addEventListener('click', async (e) => {
                        const unit = e.currentTarget.dataset.unit;
                        this.selectedUnit = unit;

                        // åŠ è½½è¯¥å•å…ƒå•è¯
                        const loadSuccess = await this.cargarCSV(this.selectedBook, unit);
                        if (loadSuccess) {
                            document.getElementById('dictadoUnitSelect').style.display = 'none';
                            document.getElementById('studentInfoPopup').style.display = 'flex';
                        }
                    });
                });

                // 6. å­¦ç”Ÿä¿¡æ¯å¼¹çª—ï¼šç‚¹å‡»ã€Œå…³é—­ã€â†’ å›åˆ°å•å…ƒé€‰æ‹©
                document.getElementById('closePopupBtn').addEventListener('click', () => {
                    document.getElementById('studentInfoPopup').style.display = 'none';
                    document.getElementById('dictadoUnitSelect').style.display = 'block';
                });

                // 7. å­¦ç”Ÿä¿¡æ¯å¼¹çª—ï¼šç‚¹å‡»ã€Œç¡®è®¤ã€â†’ æ˜¾ç¤ºå¬å†™è¾“å…¥æ¡†ï¼ˆä»…è¾“å…¥æ¡†ï¼Œæ— é€‰æ‹©é¡¹ï¼‰
                document.getElementById('confirmInfoBtn').addEventListener('click', () => {
                    const name = document.getElementById('studentName').value.trim();
                    const id = document.getElementById('studentId').value.trim();
                    
                    if (!name || !id) {
                        alert('è¯·è¾“å…¥å§“åå’Œå­¦å·');
                        return;
                    }
                    
                    this.studentName = name;
                    this.studentId = id;
                    
                    document.getElementById('studentInfoPopup').style.display = 'none';
                    document.getElementById('dictadoBox').style.display = 'block';
                    this.nuevaPalabra(); // åŠ è½½ç¬¬ä¸€ä¸ªå•è¯
                    
                    // æ¸…ç©ºè¾“å…¥æ¡†
                    document.getElementById('studentName').value = '';
                    document.getElementById('studentId').value = '';

                    if (!this.isDictadoStarted) {
                        this.startTime = Date.now();
                        this.isDictadoStarted = true;
                    }
                });

                // 8. å¬å†™è¾“å…¥æ¡†ï¼šç‚¹å‡»ã€Œç¡®å®šã€â†’ æ£€æŸ¥ç­”æ¡ˆ
                document.getElementById('dictadoCheck').addEventListener('click', () => {
                    this.verificar();
                });

                // 9. å¬å†™è¾“å…¥æ¡†ï¼šç‚¹å‡»ã€Œä¸‹ä¸€ä¸ªã€â†’ åŠ è½½ä¸‹ä¸€ä¸ªå•è¯
                document.getElementById('dictadoNext').addEventListener('click', () => {
                    this.nuevaPalabra();
                });

                // 10. å¬å†™è¾“å…¥æ¡†ï¼šå›è½¦æäº¤ç­”æ¡ˆ
                document.getElementById('dictadoInput').addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') this.verificar();
                });

                // 11. å¬å†™è¾“å…¥æ¡†ï¼šç‚¹å‡»ã€Œç»“æŸå¬å†™ã€â†’ æ˜¾ç¤ºç»“æœ
                document.getElementById('dictadoEnd').addEventListener('click', () => {
                    if (confirm('ç¡®å®šè¦ç»“æŸå¬å†™å—ï¼Ÿä¼šæ˜¾ç¤ºä½ çš„é”™è¯å¤ä¹ åˆ—è¡¨ï½')) {
                        this.endDictado();
                    }
                });
            },

            // åŠ è½½ä¸‹ä¸€ä¸ªå•è¯
            nuevaPalabra() {
                if (this.palabras.length === 0) return;

                this.isChecked = false;
                const checkBtn = document.getElementById('dictadoCheck');
                const nextBtn = document.getElementById('dictadoNext');
                checkBtn.disabled = false;
                nextBtn.disabled = true;

                let availableIndexes = this.palabras
                    .map((_, index) => index)
                    .filter(index => !this.usedIndexes.includes(index));

                if (availableIndexes.length === 0) {
                    this.usedIndexes = [];
                    availableIndexes = this.palabras.map((_, index) => index);
                }

                const randomIdx = availableIndexes[
                    Math.floor(Math.random() * availableIndexes.length)
                ];
                this.currentWord = this.palabras[randomIdx];
                this.usedIndexes.push(randomIdx);

                document.getElementById('dictadoPrompt').innerHTML = 
                    `<span style="color:#d93025;">${this.currentWord.cn}</span>ã€€<span style="color:#666;">(${this.currentWord.pos})</span>`;

                document.getElementById('dictadoInput').value = '';
                document.getElementById('dictadoResult').textContent = '';
                document.getElementById('dictadoInput').focus();
            },

            // ç§»é™¤é‡éŸ³ç¬¦å·
            removeAccents(str) {
                return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
            },

            // æ£€æŸ¥ç­”æ¡ˆ
            verificar() {
                if (this.isChecked) return;
                const input = document.getElementById('dictadoInput').value.trim();
                if (!input) return;

                const correctEs = this.currentWord.es.trim();
                let correctForms;
                if (correctEs.includes(',')) {
                    correctForms = correctEs.split(',')
                        .map(form => {
                            const trimForm = form.trim();
                            return trimForm === 'na' ? 'a' : trimForm;
                        })
                        .filter(Boolean);
                } else {
                    correctForms = [correctEs];
                }

                const isCorrect = correctForms.includes(input);
                const resultBox = document.getElementById('dictadoResult');
                
                if (isCorrect) {
                    resultBox.innerHTML = `
                        <span style="color:green;">âœ… æ­£ç¡®ï¼</span>
                        <button class="playPronunciation btn" style="margin-left:10px; padding:5px 10px; font-size:14px;">ğŸ”Š å¬è¯»éŸ³</button>
                    `;
                    this.correct++;
                } else {
                    resultBox.innerHTML = `
                        <span style="color:red;">âŒ æ­£ç¡®ç­”æ¡ˆï¼š${correctEs}</span>
                        <button class="playPronunciation btn" style="margin-left:10px; padding:5px 10px; font-size:14px;">ğŸ”Š å¬è¯»éŸ³</button>
                    `;
                    const isDuplicate = this.wrongWords.some(item => item.correctEs === correctEs && item.input === input);
                    if (!isDuplicate) {
                        this.wrongWords.push({
                            input: input,
                            correctEs: correctEs,
                            cn: this.currentWord.cn
                        });
                    }
                }

                resultBox.querySelector('.playPronunciation').addEventListener('click', () => {
                    const wordToPronounce = correctEs.split(',')[0].trim();
                    this.playPronunciation(wordToPronounce);
                });

                this.isChecked = true;
                document.getElementById('dictadoCheck').disabled = true;
                document.getElementById('dictadoNext').disabled = false;
                this.total++;
                document.getElementById('dictadoTotalCount').textContent = this.total;
            },

            // æ’­æ”¾å•è¯è¯»éŸ³
            playPronunciation(word) {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(word);
                    utterance.lang = 'es-ES';
                    window.speechSynthesis.speak(utterance);
                } else {
                    alert('å¾ˆæŠ±æ­‰ï¼Œæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³æ’­æ”¾åŠŸèƒ½');
                }
            }
        };

        // ç¿»è¯‘æ¨¡å—ï¼ˆå®Œå…¨ç‹¬ç«‹ï¼Œæ— å†²çªï¼‰
        const TranslationHandler = {
            words: [], // å­˜å‚¨å½“å‰å•å…ƒçš„ç¿»è¯‘æ•°æ®
            totalCount: 0, // æ€»ç¿»è¯‘æ•°é‡
            usedIndexes: [], // å·²ä½¿ç”¨çš„é¢˜ç›®ç´¢å¼•
            countedIndexes: [], // å·²è®¡æ•°çš„é¢˜ç›®ç´¢å¼•
            selectedBook: '', // é€‰ä¸­çš„åˆ†å†Œï¼ˆ1/2/3ï¼‰
            selectedUnit: '', // é€‰ä¸­çš„å•å…ƒï¼ˆ1-16ï¼‰
            currentIndex: null, // å½“å‰é€‰ä¸­çš„é¢˜ç›®ç´¢å¼•
            init() {
                this.bindEvents();
            },

            // åŠ è½½æŒ‡å®šå†Œæ•°+å•å…ƒçš„CSVæ–‡ä»¶ï¼ˆæ–‡ä»¶åæ ¼å¼ï¼šf1u1.csv â†’ ç¬¬ä¸€å†Œ1å•å…ƒï¼‰
            async loadCSV(book, unit) {
                this.words = []; // åˆ‡æ¢å•å…ƒæ—¶æ¸…ç©ºæ—§æ•°æ®
                const fileName = `f${book}u${unit}.csv`;
                // GitHub ä»“åº“ä¿¡æ¯ï¼ˆå’Œå¬å†™ã€é˜…è¯»ä¸€è‡´ï¼‰
                const githubUsername = "panke967";
                const githubRepo = "-Eva-practice";
                const githubBranch = "main";
                const rawUrl = `https://raw.githubusercontent.com/${githubUsername}/${githubRepo}/${githubBranch}/${fileName}`;
                
                try {
                    const response = await fetch(rawUrl);
                    if (!response.ok) throw new Error(`å•å…ƒæ–‡ä»¶ ${fileName} åŠ è½½å¤±è´¥ï¼ˆé“¾æ¥ï¼š${rawUrl}ï¼‰`);
                    
                    const text = await response.text();
                    const lines = text.trim().split('\n');

                    for (let i = 1; i < lines.length; i++) { // è·³è¿‡è¡¨å¤´
                        const line = lines[i].trim();
                        if (!line) continue;

                        // è§£æåŒå¼•å·åŒ…è£¹çš„å­—æ®µï¼ˆæ”¯æŒå­—æ®µå†…å«é€—å·ï¼‰
                        let parts = [];
                        let inQuotes = false;
                        let currentPart = '';
                        for (const char of line) {
                            if (char === '"') inQuotes = !inQuotes;
                            else if (char === ',' && !inQuotes) {
                                parts.push(currentPart.trim());
                                currentPart = '';
                            } else currentPart += char;
                        }
                        parts.push(currentPart.trim().replace(/^"|"$/g, ''));

                        // åŒåˆ—æ•°æ®è§£æï¼ˆæ ¸å¿ƒéƒ¨åˆ†ï¼‰
                        if (parts.length === 2) {
                            const [es, cn] = parts;
                            if (es.trim() && cn.trim()) {
                                this.words.push({ 
                                    es: es.trim().replace(/[\u2000-\u206F\uFEFF\u00A0]/g, ''),
                                    cn: cn.trim() 
                                });
                            }
                        }
                    }

                    console.log(`å·²åŠ è½½ç¬¬${book}å†Œç¬¬${unit}å•å…ƒï¼Œå…±${this.words.length}ä¸ªç¿»è¯‘é¢˜`);
                    if (this.words.length === 0) alert(`âš ï¸ ${fileName} ä¸­æ— æœ‰æ•ˆç¿»è¯‘æ•°æ®`);
                    return true;
                } catch (err) {
                    alert('ç¿»è¯‘æ–‡ä»¶åŠ è½½å¤±è´¥ï¼š' + err.message);
                    console.error(err);
                    return false;
                }
            },

            bindEvents() {
                // 1. ç‚¹å‡»ã€Œè¿›å…¥ç¿»è¯‘ç»ƒä¹ ã€â†’ æ˜¾ç¤ºåˆ†å†Œé€‰æ‹©ç•Œé¢
                document.getElementById('trans-translationStart').addEventListener('click', () => {
                    document.getElementById('trans-translationInit').style.display = 'none';
                    document.getElementById('trans-translationBookSelect').style.display = 'block';
                });

                // 2. åˆ†å†Œé€‰æ‹©é¡µè¿”å› â†’ éšè—åˆ†å†Œé€‰æ‹©ï¼Œæ˜¾ç¤ºåˆå§‹æŒ‰é’®
                document.getElementById('trans-translationBackToInit').addEventListener('click', () => {
                    document.getElementById('trans-translationBookSelect').style.display = 'none';
                    document.getElementById('trans-translationInit').style.display = 'block';
                    this.reset();
                });

                // 3. é€‰æ‹©åˆ†å†Œï¼ˆä»…ç¬¬ä¸€å†Œå¯ç”¨ï¼‰â†’ æ˜¾ç¤ºå•å…ƒé€‰æ‹©ç•Œé¢
                document.querySelectorAll('#trans-translationBookSelect .trans-book-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const book = e.currentTarget.dataset.book;
                        if (e.currentTarget.classList.contains('disabled')) {
                            alert(`ç¬¬ ${book} å†Œæš‚æœªå¼€æ”¾ï¼Œæ•¬è¯·æœŸå¾…ï¼`);
                            return;
                        }
                        this.selectedBook = book;
                        document.getElementById('trans-translationBookSelect').style.display = 'none';
                        document.getElementById('trans-translationUnitSelect').style.display = 'block';
                    });
                });

                // 4. å•å…ƒé€‰æ‹©é¡µè¿”å› â†’ éšè—å•å…ƒé€‰æ‹©ï¼Œæ˜¾ç¤ºåˆ†å†Œé€‰æ‹©
                document.getElementById('trans-translationBackToBookSelect').addEventListener('click', () => {
                    document.getElementById('trans-translationUnitSelect').style.display = 'none';
                    document.getElementById('trans-translationBookSelect').style.display = 'block';
                    this.reset();
                });

                // 5. é€‰æ‹©å•å…ƒ â†’ åŠ è½½å¯¹åº”æ–‡ä»¶å¹¶æ˜¾ç¤ºç»ƒä¹ ç•Œé¢
                document.querySelectorAll('#trans-translationUnitSelect .trans-unit-btn').forEach(btn => {
                    btn.addEventListener('click', async (e) => {
                        const unit = e.currentTarget.dataset.unit;
                        this.selectedUnit = unit;

                        const loadSuccess = await this.loadCSV(this.selectedBook, this.selectedUnit);
                        if (loadSuccess) {
                            document.getElementById('trans-translationUnitSelect').style.display = 'none';
                            document.getElementById('trans-translationBox').style.display = 'block';
                            this.reset();
                            this.nextWord();
                        }
                    });
                });

                // 6. æ£€æŸ¥æ ¸å¯¹æŒ‰é’®äº‹ä»¶
                document.getElementById('trans-translationCheck').addEventListener('click', () => {
                    if (this.words.length === 0) return;
                    const currentWord = this.words[this.currentIndex];
                    const answerEl = document.getElementById('trans-translationAnswer');
                    answerEl.textContent = `æ­£ç¡®ç­”æ¡ˆï¼š${currentWord.es}`;
                    answerEl.style.display = 'block';

                    if (!this.countedIndexes.includes(this.currentIndex)) {
                        this.totalCount++;
                        this.countedIndexes.push(this.currentIndex);
                        document.getElementById('trans-translationTotalCount').textContent = this.totalCount;
                    }
                    document.getElementById('trans-translationNext').disabled = false;
                });

                // 7. ä¸‹ä¸€å¥æŒ‰é’®äº‹ä»¶
                document.getElementById('trans-translationNext').addEventListener('click', () => {
                    this.nextWord();
                });

                // 8. ç»“æŸç»ƒä¹ æŒ‰é’®äº‹ä»¶ â†’ è¿”å›å•å…ƒé€‰æ‹©ç•Œé¢
                document.getElementById('trans-translationEnd').addEventListener('click', () => {
                    if (confirm(`ç¡®å®šç»“æŸç»ƒä¹ å—ï¼Ÿå·²å®Œæˆ${this.totalCount}é¢˜`)) {
                        document.getElementById('trans-translationBox').style.display = 'none';
                        this.reset();
                        document.getElementById('trans-translationUnitSelect').style.display = 'block';
                    }
                });
            },

            // åˆ‡æ¢ä¸‹ä¸€ä¸ªç¿»è¯‘é¢˜
            nextWord() {
                document.getElementById('trans-translationInput').value = '';
                document.getElementById('trans-translationAnswer').style.display = 'none';
                document.getElementById('trans-translationNext').disabled = true;

                if (this.usedIndexes.length >= this.words.length) this.usedIndexes = [];

                let randomIdx;
                do {
                    randomIdx = Math.floor(Math.random() * this.words.length);
                } while (this.usedIndexes.includes(randomIdx));

                this.currentIndex = randomIdx;
                this.usedIndexes.push(randomIdx);
                const currentWord = this.words[this.currentIndex];
                document.getElementById('trans-translationPrompt').textContent = currentWord.cn;
                document.getElementById('trans-translationInput').focus();
            },

            // é‡ç½®ç»ƒä¹ çŠ¶æ€ï¼ˆåˆ‡æ¢å•å…ƒ/ç»“æŸç»ƒä¹ æ—¶è°ƒç”¨ï¼‰
            reset() {
                this.totalCount = 0;
                this.usedIndexes = [];
                this.countedIndexes = [];
                document.getElementById('trans-translationTotalCount').textContent = '0';
            }
        };

        // åŠ¨è¯å˜ä½ç»ƒä¹ æ ¸å¿ƒé€»è¾‘ï¼ˆä¿æŒåŸæœ‰ä¸å˜ï¼‰
        const ConjugationHandler = {
            // æ ¸å¿ƒæ•°æ®
            verbs: [], // å­˜å‚¨å½“å‰å•å…ƒçš„åŠ¨è¯ï¼ˆä»CSVåŠ è½½ï¼‰
            usedIndexes: [], // å·²ä½¿ç”¨çš„åŠ¨è¯ç´¢å¼•ï¼ˆé¿å…é‡å¤ï¼‰
            currentVerb: null, // å½“å‰ç»ƒä¹ çš„åŠ¨è¯
            studentName: '', // å­¦ç”Ÿå§“å
            studentId: '', // å­¦ç”Ÿå­¦å·
            selectedBook: null, // é€‰ä¸­çš„åˆ†å†Œ
            selectedUnit: null, // é€‰ä¸­çš„å•å…ƒ
            startTime: null, // ç»ƒä¹ å¼€å§‹æ—¶é—´
            isStarted: false, // ç»ƒä¹ æ˜¯å¦å·²å¼€å§‹
            stats: {
                total: 0, // æ€»ç»ƒä¹ åŠ¨è¯æ•°
                correctCount: 0, // å…¨å¯¹çš„åŠ¨è¯æ•°
                wrongRecords: [] // é”™è¯¯è®°å½•ï¼ˆåŠ¨è¯+é”™è¯¯å˜ä½ï¼‰
            },

            // åˆå§‹åŒ–
            init() {
                this.bindEvents();
            },

            // åŠ è½½å•å…ƒCSVæ–‡ä»¶ï¼ˆæ ¼å¼ï¼šconj+åˆ†å†Œ+å•å…ƒ.csvï¼Œå¦‚conj1u1.csvï¼‰
            async loadUnitCSV(book, unit) {
                try {
                    // GitHubä»“åº“è·¯å¾„ï¼ˆè¯·ç¡®ä¿ä¸ä½ çš„å¬å†™/ç¿»è¯‘æ¨¡å—è·¯å¾„ä¸€è‡´ï¼‰
                    const githubUsername = "panke967";
                    const githubRepo = "-Eva-practice";
                    const githubBranch = "main";
                    const fileName = `conj${book}u${unit}.csv`; // æ–‡ä»¶åæ ¼å¼ï¼šconj1u1.csv
                    const rawUrl = `https://raw.githubusercontent.com/${githubUsername}/${githubRepo}/${githubBranch}/${fileName}`;

                    const response = await fetch(rawUrl);
                    if (!response.ok) throw new Error(`ç¬¬${book}å†Œç¬¬${unit}å•å…ƒæ–‡ä»¶ã€Œ${fileName}ã€åŠ è½½å¤±è´¥`);

                    const csvText = await response.text();
                    this.parseCSV(csvText); // è§£æCSV
                    return true;
                } catch (err) {
                    alert('âŒ åŠ¨è¯æ–‡ä»¶åŠ è½½å¤±è´¥ï¼š' + err.message);
                    console.error(err);
                    return false;
                }
            },

            // è§£æCSVï¼ˆæ”¯æŒè¡¨å¤´ï¼šinfinitive,yo,tu,el,nosotros,vosotros,ellosï¼‰
            parseCSV(csvText) {
                this.verbs = [];
                const lines = csvText.trim().split('\n');
                if (lines.length <= 1) { // è‡³å°‘éœ€è¦è¡¨å¤´+1è¡Œæ•°æ®
                    alert('âš ï¸ CSVæ–‡ä»¶æ— æœ‰æ•ˆåŠ¨è¯æ•°æ®');
                    return;
                }

                // è·³è¿‡è¡¨å¤´ï¼Œä»ç¬¬2è¡Œå¼€å§‹è§£ææ•°æ®
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;

                    // æ¸…ç†CSVå­—æ®µï¼ˆå¤„ç†å¼•å·å’Œç©ºå­—ç¬¦ï¼‰
                    const parts = line.replace(/^"|"$/g, '').split(',').map(item => item.trim());
                    if (parts.length !== 7) { // å¿…é¡»åŒ…å«7ä¸ªå­—æ®µï¼ˆåŠ¨è¯åŸå½¢+6ä¸ªäººç§°ï¼‰
                        console.warn(`è·³è¿‡æ ¼å¼é”™è¯¯è¡Œï¼š${line}`);
                        continue;
                    }

                    // ç»„è£…åŠ¨è¯æ•°æ®
                    this.verbs.push({
                        infinitive: parts[0], // ç¬¬1åˆ—ï¼šåŠ¨è¯åŸå½¢ï¼ˆinfinitiveï¼‰
                        conjugations: {
                            yo: parts[1], // ç¬¬2åˆ—ï¼šyoå˜ä½
                            tu: parts[2], // ç¬¬3åˆ—ï¼štuå˜ä½
                            el: parts[3], // ç¬¬4åˆ—ï¼šelå˜ä½
                            nosotros: parts[4], // ç¬¬5åˆ—ï¼šnosotroså˜ä½
                            vosotros: parts[5], // ç¬¬6åˆ—ï¼švosotroså˜ä½
                            ellos: parts[6] // ç¬¬7åˆ—ï¼šelloså˜ä½
                        }
                    });
                }

                if (this.verbs.length === 0) {
                    alert('âš ï¸ æœªä»CSVä¸­è§£æåˆ°ä»»ä½•æœ‰æ•ˆåŠ¨è¯');
                } else {
                    console.log(`æˆåŠŸåŠ è½½ ${this.verbs.length} ä¸ªåŠ¨è¯`);
                }
            },

            // éšæœºé€‰æ‹©ä¸€ä¸ªæœªç»ƒä¹ è¿‡çš„åŠ¨è¯
            getRandomVerb() {
                // æ‰€æœ‰åŠ¨è¯éƒ½å·²ç»ƒä¹ è¿‡ï¼Œé‡ç½®ç´¢å¼•
                if (this.usedIndexes.length >= this.verbs.length) {
                    this.usedIndexes = [];
                }

                // ç­›é€‰æœªä½¿ç”¨çš„ç´¢å¼•
                const availableIndexes = this.verbs
                    .map((_, idx) => idx)
                    .filter(idx => !this.usedIndexes.includes(idx));
                
                // éšæœºé€‰ä¸€ä¸ª
                const randomIdx = availableIndexes[Math.floor(Math.random() * availableIndexes.length)];
                this.usedIndexes.push(randomIdx);
                return this.verbs[randomIdx];
            },

            // åŠ è½½å½“å‰åŠ¨è¯åˆ°ç•Œé¢
            loadCurrentVerb() {
                this.currentVerb = this.getRandomVerb();
                document.getElementById('conjCurrentVerb').textContent = this.currentVerb.infinitive;

                // é‡ç½®è¾“å…¥æ¡†å’Œæ ‡è®°
                const inputs = document.querySelectorAll('#conjPracticeBox input[data-person]');
                inputs.forEach(input => {
                    input.value = '';
                    input.disabled = false;
                    input.parentElement.querySelector('.conj-check-mark').style.display = 'none';
                    input.parentElement.querySelector('.conj-error-mark').style.display = 'none';
                });

                // éšè—æ­£ç¡®ç­”æ¡ˆï¼Œå¯ç”¨æ ¸å¯¹æŒ‰é’®ï¼Œç¦ç”¨ä¸‹ä¸€ä¸ªæŒ‰é’®
                document.getElementById('conjCorrectAnswers').style.display = 'none';
                document.getElementById('conjCheck').disabled = false;
                document.getElementById('conjNext').disabled = true;

                // èšç„¦ç¬¬ä¸€ä¸ªè¾“å…¥æ¡†
                inputs[0].focus();
            },

            // æ ¸å¯¹ç­”æ¡ˆï¼ˆä¸¥æ ¼åŒ¹é…é‡éŸ³å’Œå­—ç¬¦ï¼‰
            checkAnswers() {
                const inputs = document.querySelectorAll('#conjPracticeBox input[data-person]');
                const correctConj = this.currentVerb.conjugations;
                let isAllCorrect = true; // æ˜¯å¦å…¨å¯¹
                const wrongDetails = { // é”™è¯¯è®°å½•
                    verb: this.currentVerb.infinitive,
                    wrongItems: []
                };

                // é€ä¸ªäººç§°æ ¸å¯¹ï¼ˆä¸¥æ ¼åŒ¹é…ï¼šå­—ç¬¦ã€é‡éŸ³å®Œå…¨ä¸€è‡´ï¼‰
                inputs.forEach(input => {
                    const person = input.dataset.person;
                    const userInput = input.value.trim(); // ä¿ç•™åŸå§‹è¾“å…¥ï¼ˆä¸è½¬å°å†™ã€ä¸åˆ é‡éŸ³ï¼‰
                    const correctAnswer = correctConj[person]; // CSVä¸­çš„æ­£ç¡®ç­”æ¡ˆï¼ˆå«é‡éŸ³ï¼‰

                    const isCorrect = userInput === correctAnswer;

                    // æ˜¾ç¤ºå¯¹é”™æ ‡è®°
                    if (isCorrect) {
                        input.parentElement.querySelector('.conj-check-mark').style.display = 'inline';
                    } else {
                        input.parentElement.querySelector('.conj-error-mark').style.display = 'inline';
                        isAllCorrect = false;
                        // è®°å½•é”™è¯¯é¡¹
                        wrongDetails.wrongItems.push({
                            person: this.getPersonName(person),
                            userInput: input.value.trim(),
                            correctAnswer: correctConj[person]
                        });
                    }

                    input.disabled = true; // æ ¸å¯¹åç¦ç”¨è¾“å…¥æ¡†
                });

                // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
                this.showCorrectAnswers();

                // æ›´æ–°ç»Ÿè®¡
                this.stats.total++;
                if (isAllCorrect) {
                    this.stats.correctCount++;
                } else {
                    this.stats.wrongRecords.push(wrongDetails); // è®°å½•é”™è¯¯
                }
                document.getElementById('conjTotalCount').textContent = this.stats.total;

                // ç¦ç”¨æ ¸å¯¹æŒ‰é’®ï¼Œå¯ç”¨ä¸‹ä¸€ä¸ªæŒ‰é’®
                document.getElementById('conjCheck').disabled = true;
                document.getElementById('conjNext').disabled = false;
            },

            // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
            showCorrectAnswers() {
                const answersList = document.getElementById('conjAnswersList');
                const correctConj = this.currentVerb.conjugations;
                const personNames = {
                    yo: "æˆ‘ (yo)",
                    tu: "ä½  (tÃº)",
                    el: "ä»–/å¥¹/æ‚¨ (Ã©l/ella/usted)",
                    nosotros: "æˆ‘ä»¬ (nosotros)",
                    vosotros: "ä½ ä»¬ (vosotros)",
                    ellos: "ä»–ä»¬/å¥¹ä»¬/è¯¸ä½ (ellos/ellas/ustedes)"
                };

                // ç»„è£…ç­”æ¡ˆHTML
                let html = '';
                for (const [key, value] of Object.entries(correctConj)) {
                    html += `<div>${personNames[key]}: <strong style="color: #009100;">${value}</strong></div>`;
                }
                answersList.innerHTML = html;
                document.getElementById('conjCorrectAnswers').style.display = 'block';
            },

            // ç»“æŸç»ƒä¹ ï¼Œæ˜¾ç¤ºç»“æœå¼¹çª—ï¼ˆä¸å¬å†™æ ¼å¼å®Œå…¨ä¸€è‡´ï¼‰
            endPractice() {
                document.getElementById('conjPracticeBox').style.display = 'none';
                const accuracy = this.stats.total > 0 ? (this.stats.correctCount / this.stats.total * 100).toFixed(2) : 0;
                
                // ç»„è£…é”™è¯¯è®°å½•HTML
                let wrongHtml = '';
                if (this.stats.wrongRecords.length > 0) {
                    wrongHtml = this.stats.wrongRecords.map((record, idx) => {
                        const wrongItems = record.wrongItems.map(item => `
                            <div style="margin-left: 15px; margin-top: 5px;">
                                ${item.person}ï¼š<span style="color:red;">${item.userInput || 'æœªè¾“å…¥'}</span> â†’ 
                                <span style="color:green;">${item.correctAnswer}</span>
                            </div>
                        `).join('');
                        return `
                            <li style="margin: 8px 0; line-height: 1.5;">
                                ${idx + 1}. åŠ¨è¯ï¼š${record.verb}
                                ${wrongItems}
                            </li>
                        `;
                    }).join('');
                } else {
                    wrongHtml = '<li style="color:#666;">ğŸ‰ æ²¡æœ‰é”™è¯¯ï¼Œå¤ªæ£’äº†ï¼</li>';
                }

                // è®¡ç®—è€—æ—¶
                const endTime = Date.now();
                const totalMs = endTime - this.startTime;
                const minutes = Math.floor(totalMs / 60000);
                const seconds = Math.floor((totalMs % 60000) / 1000);
                const formattedTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                const finishTime = new Date(endTime).toLocaleString('zh-CN');

                // ç»“æœå¼¹çª—HTML
                const resultHtml = `
                <div style="font-size: 16px; line-height: 2; padding: 10px;">
                    <p>ğŸ“ å­¦ç”Ÿä¿¡æ¯ï¼š</p>
                    <p>å§“åï¼š${this.studentName}</p>
                    <p>å­¦å·ï¼š${this.studentId}</p>
                    <p>ç»ƒä¹ åˆ†å†Œï¼šç¬¬ ${this.selectedBook} å†Œ</p>
                    <p>ç»ƒä¹ å•å…ƒï¼šç¬¬ ${this.selectedUnit} å•å…ƒ</p>
                    <p style="margin-top: 15px;">ğŸ“Š ç»ƒä¹ ç»“æœï¼š</p>
                    <p>æ€»ç»ƒä¹ åŠ¨è¯ï¼š${this.stats.total} ä¸ª</p>
                    <p>å…¨å¯¹åŠ¨è¯ï¼š${this.stats.correctCount} ä¸ª</p>
                    <p>æ­£ç¡®ç‡ï¼š${accuracy}%</p>
                    <p>å®Œæˆæ—¶é—´ï¼š${finishTime}</p>
                    <p>æ€»è€—æ—¶ï¼š${formattedTime}</p>
                    <p style="margin-top: 15px; font-weight: bold;">é”™è¯¯å¤ä¹ ï¼š</p>
                    <ul style="margin: 5px 0; padding-left: 20px;">${wrongHtml}</ul>
                </div>
                `;

                // åˆ›å»ºå¼¹çª—ï¼ˆä¸å¬å†™æ ¼å¼ä¸€è‡´ï¼‰
                const popup = document.createElement('div');
                popup.style.cssText = `
                    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                    background: white; padding: 20px; border: 2px solid #d93025; border-radius: 8px;
                    max-width: 400px; width: 85%; max-height: 70vh; overflow-y: auto; z-index: 9999; padding-top: 40px;
                `;
                popup.innerHTML = `
                    ${resultHtml}
                    <button id="conjPopupCloseBottom" style="
                        margin-top: 15px; padding: 8px 20px; 
                        background: #d93025; color: white; 
                        border: none; border-radius: 4px; cursor: pointer;
                        display: block; margin-left: auto; margin-right: auto;">
                        å…³é—­
                    </button>
                `;

                // åˆ›å»ºé®ç½©å±‚
                const mask = document.createElement('div');
                mask.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9998;';
                
                // æ·»åŠ åˆ°é¡µé¢
                document.body.appendChild(mask);
                document.body.appendChild(popup);

                // å…³é—­å¼¹çª—äº‹ä»¶
                document.getElementById('conjPopupCloseBottom').addEventListener('click', () => {
                    document.body.removeChild(popup);
                    document.body.removeChild(mask);
                    // å›åˆ°å•å…ƒé€‰æ‹©ç•Œé¢
                    document.getElementById('conjUnitSelect').style.display = 'block';
                    this.resetStats(); // é‡ç½®ç»Ÿè®¡
                });
            },

            // é‡ç½®ç»Ÿè®¡æ•°æ®
            resetStats() {
                this.stats = {
                    total: 0,
                    correctCount: 0,
                    wrongRecords: []
                };
                this.usedIndexes = [];
                this.currentVerb = null;
                this.isStarted = false;
            },

            // è¾…åŠ©ï¼šè·å–äººç§°å®Œæ•´åç§°
            getPersonName(key) {
                const names = {
                    yo: "æˆ‘ (yo)",
                    tu: "ä½  (tÃº)",
                    el: "ä»–/å¥¹/æ‚¨ (Ã©l/ella/usted)",
                    nosotros: "æˆ‘ä»¬ (nosotros)",
                    vosotros: "ä½ ä»¬ (vosotros)",
                    ellos: "ä»–ä»¬/å¥¹ä»¬/è¯¸ä½ (ellos/ellas/ustedes)"
                };
                return names[key] || key;
            },

            // ç»‘å®šæ‰€æœ‰äº‹ä»¶ï¼ˆå±‚çº§æµç¨‹ä¸å¬å†™ä¸€è‡´ï¼‰
            bindEvents() {
                // 1. åˆå§‹çŠ¶æ€ â†’ åˆ†å†Œé€‰æ‹©
                document.getElementById('conjStart').addEventListener('click', () => {
                    document.getElementById('conjInit').style.display = 'none';
                    document.getElementById('conjBookSelect').style.display = 'block';
                });

                // 2. åˆ†å†Œé€‰æ‹© â†’ åˆå§‹çŠ¶æ€
                document.getElementById('conjBackToInit').addEventListener('click', () => {
                    document.getElementById('conjBookSelect').style.display = 'none';
                    document.getElementById('conjInit').style.display = 'flex'; // æ”¹ä¸ºflexä¿æŒå±…ä¸­
                });

                // 3. åˆ†å†Œé€‰æ‹© â†’ å•å…ƒé€‰æ‹©
                document.querySelectorAll('#conjBookSelect .book-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const book = e.currentTarget.dataset.book;
                        if (e.currentTarget.classList.contains('disabled')) {
                            alert(`ç¬¬ ${book} å†Œæš‚æœªå¼€æ”¾ï¼Œæ•¬è¯·æœŸå¾…ï¼`);
                            return;
                        }
                        this.selectedBook = book;
                        document.getElementById('conjBookSelect').style.display = 'none';
                        document.getElementById('conjUnitSelect').style.display = 'block';
                    });
                });

                // 4. å•å…ƒé€‰æ‹© â†’ åˆ†å†Œé€‰æ‹©
                document.getElementById('conjBackToBookSelect').addEventListener('click', () => {
                    document.getElementById('conjUnitSelect').style.display = 'none';
                    document.getElementById('conjBookSelect').style.display = 'block';
                });

                // 5. å•å…ƒé€‰æ‹© â†’ å­¦ç”Ÿä¿¡æ¯å¼¹çª—
                document.querySelectorAll('#conjUnitSelect .unit-btn').forEach(btn => {
                    btn.addEventListener('click', async (e) => {
                        const unit = e.currentTarget.dataset.unit;
                        this.selectedUnit = unit;

                        // åŠ è½½å½“å‰å•å…ƒçš„CSVæ–‡ä»¶
                        const loadSuccess = await this.loadUnitCSV(this.selectedBook, unit);
                        if (loadSuccess && this.verbs.length > 0) {
                            document.getElementById('conjUnitSelect').style.display = 'none';
                            document.getElementById('conjStudentInfoPopup').style.display = 'flex';
                        }
                    });
                });

                // 6. å…³é—­å­¦ç”Ÿä¿¡æ¯å¼¹çª— â†’ å•å…ƒé€‰æ‹©
                document.getElementById('conjClosePopupBtn').addEventListener('click', () => {
                    document.getElementById('conjStudentInfoPopup').style.display = 'none';
                    document.getElementById('conjUnitSelect').style.display = 'block';
                });

                // 7. ç¡®è®¤å­¦ç”Ÿä¿¡æ¯ â†’ ç»ƒä¹ ç•Œé¢
                document.getElementById('conjConfirmInfoBtn').addEventListener('click', () => {
                    const name = document.getElementById('conjStudentName').value.trim();
                    const id = document.getElementById('conjStudentId').value.trim();
                    
                    if (!name || !id) {
                        alert('è¯·è¾“å…¥å§“åå’Œå­¦å·');
                        return;
                    }

                    // ä¿å­˜å­¦ç”Ÿä¿¡æ¯
                    this.studentName = name;
                    this.studentId = id;
                    
                    // æ˜¾ç¤ºç»ƒä¹ ç•Œé¢ï¼ŒåŠ è½½ç¬¬ä¸€ä¸ªåŠ¨è¯
                    document.getElementById('conjStudentInfoPopup').style.display = 'none';
                    document.getElementById('conjPracticeBox').style.display = 'block';
                    this.loadCurrentVerb();

                    // è®°å½•å¼€å§‹æ—¶é—´
                    if (!this.isStarted) {
                        this.startTime = Date.now();
                        this.isStarted = true;
                    }

                    // æ¸…ç©ºè¾“å…¥æ¡†
                    document.getElementById('conjStudentName').value = '';
                    document.getElementById('conjStudentId').value = '';
                });

                // 8. æ ¸å¯¹ç­”æ¡ˆæŒ‰é’®
                document.getElementById('conjCheck').addEventListener('click', () => {
                    this.checkAnswers();
                });

                // 9. ä¸‹ä¸€ä¸ªåŠ¨è¯æŒ‰é’®
                document.getElementById('conjNext').addEventListener('click', () => {
                    this.loadCurrentVerb();
                });

                // 10. ç»“æŸç»ƒä¹ æŒ‰é’®
                document.getElementById('conjEnd').addEventListener('click', () => {
                    if (confirm('ç¡®å®šè¦ç»“æŸç»ƒä¹ å—ï¼Ÿä¼šæ˜¾ç¤ºä½ çš„ç»ƒä¹ ç»“æœå’Œé”™è¯¯å¤ä¹ åˆ—è¡¨ï½')) {
                        this.endPractice();
                    }
                });

                // 11. å›è½¦åˆ‡æ¢è¾“å…¥æ¡†ï¼ˆæœ€åä¸€ä¸ªå›è½¦æ ¸å¯¹ï¼‰
                const inputs = document.querySelectorAll('#conjPracticeBox input[data-person]');
                inputs.forEach((input, index) => {
                    input.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            if (index === inputs.length - 1) {
                                // æœ€åä¸€ä¸ªè¾“å…¥æ¡†ï¼Œç‚¹å‡»æ ¸å¯¹
                                this.checkAnswers();
                            } else {
                                // åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªè¾“å…¥æ¡†
                                inputs[index + 1].focus();
                            }
                        }
                    });
                });
            }
        };

        // åˆå§‹åŒ–æ‰€æœ‰æ¨¡å—
        window.addEventListener('DOMContentLoaded', () => {
            ReadingHandler.init();
            DictadoHandler.init();
            TranslationHandler.init();
            ConjugationHandler.init();
        });


    </script>
</body>
</html>